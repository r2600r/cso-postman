{
	"info": {
		"_postman_id": "fd66b750-9a93-4f79-950e-9d42f4835605",
		"name": "CSO site loop",
		"description": "This runner will start site deployment in CSO making sure it follows correct order (configure, bootstrap, zero, service provisioning, auto-nat/sdwan/fw and dhcp update for WAN_0/1, create corresponding site in MIST if it does not exist and add SRX/vSRX to that site. Sleep for 15 minutes to gather some statistics and delete the site from CSO and MIST.\n\nReplace or modify JSON in body of CSO-site_creation. Make sure ***site_name*** matches your selected site name if not using that variable in JSON\n\n#### **Required**\n\n***base_url*** environmental variable ie [https://cso.juniper.net](https://cso.juniper.net)  \n***host*** environmental variable ie [https://api.mist.com](https://api.mist.com)\n\n***username*** environmental variable, ie cso username  \n***password*** environmental variable, ie cso password  \n***tenant_name*** environmental variable, ie cso tenant\n\n***site_name*** environmental variable ie PB-Abuse-vSRX\n\n***mist_apitoken*** environmental variable ie mist api token valide for given org\n\n***org_id*** environmental variable ie mist organization ID\n\n* * *\n\n#### **Optional**\n\n***site_id*** environmental variable ie mist site ID",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "CSO-get_token",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"/*",
							"pm.globals.set(\"TENANT_NAME\", \"STAGING\");",
							"pm.globals.set(\"SITE_NAME\", \"LTE-VZW\");",
							"pm.globals.set(\"ADDR_STREET\", \"2020 El Sereno Ave\");",
							"pm.globals.set(\"ADDR_CITY\", \"Los Altos\");",
							"pm.globals.set(\"ADDR_STATE\", \"CA\");",
							"pm.globals.set(\"ADDR_ZIP\", \"94024\");",
							"pm.globals.set(\"ADDR_COUNTRY\", \"US\");",
							"pm.globals.set(\"TIME_ZONE\", \"America/Los_Angeles\");",
							"pm.globals.set(\"FIRST_NAME\", \"Shay\");",
							"pm.globals.set(\"LAST_NAME\", \"Dunevich\");",
							"pm.globals.set(\"EMAIL_ADDRESS\", \"shay@dunevich.com\");",
							"pm.globals.set(\"PHONE_NUMBER\", \"4088814500\");",
							"pm.globals.set(\"DEVICE_SN\", \"CX3619AN0499\");",
							"*/",
							"",
							"function cleanup() {",
							"    const clean = _.keys(pm.collectionVariables.toObject())",
							"    _.each(clean, (arrItem) => {",
							"        pm.collectionVariables.unset(arrItem);",
							"        console.log(`Cleaning Item: ${arrItem}`);",
							"    })",
							"}",
							"console.log(cleanup());"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"//postman.setGlobalVariable(\"Tenant-Admin-OpenLab\", postman.getResponseHeader(\"X-Subject-Token\"));",
							"pm.environment.set('token', postman.getResponseHeader(\"X-Subject-Token\"));",
							"console.log(`Creatign site PB-`+ pm.info.requestName);",
							"console.log(`Got Token: ${pm.environment.get('token')}`);"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n  \"auth\": {\r\n\t\"identity\": {\r\n\t\t\"methods\": [\"password\"],\r\n\t\t\"password\": {\r\n\t\t\t\"user\": {\r\n\t\t\t\t\"domain\": {\r\n\t\t\t\t\t\"id\": \"default\"\r\n\t\t\t\t},\r\n\t\t\t\t\"name\": \"{{user_name}}\",\r\n\t\t\t\t\"password\": \"{{password}}\"\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\"scope\": {\r\n     \"project\": {\r\n       \"domain\": {\r\n         \"id\": \"default\"\r\n       },\r\n       \"name\": \"{{tenant_name}}\"\r\n     }\r\n    }\r\n  }\r\n}"
				},
				"url": {
					"raw": "{{base_url}}/v3/auth/tokens",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"v3",
						"auth",
						"tokens"
					]
				}
			},
			"response": []
		},
		{
			"name": "CSO-site_creation",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"console.log('-------------------- SITE CREATION --------------------------------------');",
							"function cleanup() {",
							"    const clean = _.keys(pm.collectionVariables.toObject())",
							"    _.each(clean, (arrItem) => {",
							"        pm.collectionVariables.unset(arrItem);",
							"        console.log(`Cleaning Item: ${arrItem}`);",
							"    })",
							"}",
							"console.log(cleanup());",
							""
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"console.log(`Creating site ${pm.environment.get('site_name')}`);",
							"var moment = require('moment');",
							"var jsonData = JSON.parse(responseBody);",
							"nextRequest = null;",
							"",
							"pm.test(\"Results is not empty\", function() {",
							"  pm.expect(jsonData.results).length >= 1;",
							"});",
							"if (pm.response.code == 200 && jsonData.output.job_id.length >= 1) {",
							"",
							"    // Unsetting Enviroment variable in case it is define as it beats collection variable",
							"    var env_job_id = pm.environment.get('job_id');",
							"    if (env_job_id == true || (env_job_id && env_job_id.length >0)) {",
							"        //pm.environment.disabled('job_id');",
							"        pm.environment.unset('job_id',);",
							"        console.log('Detected Enviroment variable job_id also used in collectionVariables, unseting env ...')",
							"    }",
							"",
							"    pm.test(\"Site is being created ... \", function() {",
							"    pm.expect(pm.response.code).to.equal(200);",
							"    });",
							"    pm.collectionVariables.set(\"job_id\", jsonData.output.job_id)",
							"    console.log(`job ID: ${pm.collectionVariables.get('job_id')}`);",
							"",
							"    pm.collectionVariables.set(\"status\", jsonData.output.status)",
							"    console.log(`status: ${pm.collectionVariables.get('status')}`);",
							"    nextRequest = 'CSO-job_status'",
							"    ",
							"    //unseting local variable",
							"    pm.collectionVariables.unset(pm.environment.get('site_name') + '-configure');",
							"    pm.collectionVariables.unset('job_search_start_time');",
							"    pm.collectionVariables.unset(pm.environment.get('site_name') + '-provisioned');",
							"    pm.collectionVariables.unset('job_search_regex');",
							"    pm.collectionVariables.unset('jobs');",
							"    pm.collectionVariables.unset('AUTO_SDWAN');",
							"    pm.collectionVariables.unset('AUTO_FW');",
							"    pm.collectionVariables.unset('AUTO_NAT');",
							"}",
							"// Site already exist",
							"if (pm.response.code == 500 && jsonData.error_app_message.includes(pm.environment.get('site_name') + ' already exists in cso')) {",
							"    pm.test(\"Site could not be created, already exist ... \", function() {",
							"        pm.expect(pm.response.code).to.equal(200);",
							"    });",
							"    nextRequest = 'CSO-get_all_devices';",
							"}",
							"// Site is being deleted",
							"if (pm.response.code == 500 && jsonData.error_app_message.includes(' still in-progress state' + pm.environment.get('site_name'))) {",
							"    pm.test(\"Site could not be created, in progress of being deleted ... \", function() {",
							"        pm.expect(pm.response.code).to.equal(200);",
							"    });",
							"    setTimeout(function() {}, 60000*5); // sleep 5 minute's and trying again",
							"    nextRequest = 'CSO-site_creation';",
							"}",
							"",
							"// Bad request",
							"if (pm.response.code == 400 && jsonData.error.message.length >= 1) {",
							"    pm.test(`Site could not be created, bad request - ${jsonData.error.message} ... `, function() {",
							"        pm.expect(pm.response.code).to.equal(200);",
							"    });",
							"}",
							"console.log(`setting next request ... ${nextRequest}`);",
							"postman.setNextRequest(nextRequest);",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "apikey",
					"apikey": [
						{
							"key": "value",
							"value": "{{token}}",
							"type": "string"
						},
						{
							"key": "key",
							"value": "x-auth-token",
							"type": "string"
						},
						{
							"key": "in",
							"value": "header",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"type": "text",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n  \"input\": {\r\n    \"tenant_name\": \"OpenLab\",\r\n    \"deployment_scenario\": \"managed_wan_v2\",\r\n    \"site\": [\r\n      {\r\n        \"site_name\": \"{{site_name}}\",\r\n        \"site_basic_properties\": {\r\n          \"site_name\": \"{{site_name}}\",\r\n          \"device_host_name\": \"OpenLab.{{site_name}}\",\r\n          \"site_group\": [\r\n            \"Retail\"\r\n          ],\r\n          \"site_role\": \"SPOKE\",\r\n          \"site_address\": {\r\n            \"street\": \"\",\r\n            \"city\": \"Denver\",\r\n            \"state\": \"\",\r\n            \"zip_code\": \"80205\",\r\n            \"country\": \"US\"\r\n          },\r\n          \"site_contact\": {\r\n            \"contact_name\": \"\",\r\n            \"email_address\": \"\",\r\n            \"phone_number\": \"\"\r\n          },\r\n          \"cloud_service\": \"EDGE\",\r\n          \"site_type\": \"on_premise\",\r\n          \"topology\": \"mesh\",\r\n          \"sla_mgmt\": \"FINE\",\r\n          \"network_seg\": false,\r\n          \"device_template\": [\r\n            {\r\n              \"template_name\": \"OpenLab/POC_SRX_CPE\",\r\n              \"platform_template\": \"OpenLab/SRX_Platform_cloned\",\r\n              \"device_name\": \"{{site_name}}\",\r\n              \"device_discovery_type\": \"NEW\",\r\n              \"wan_link_info\": [\r\n                {\r\n                  \"wan_link\": \"WAN_0\",\r\n                  \"wan_link_type\": \"Internet\",\r\n                  \"cost_currency\": \"USD\",\r\n                  \"access_type\": \"Ethernet\",\r\n                  \"local_breakout_enabled\": true,\r\n                  \"provider\": \"Xfinity\",\r\n                  \"cost\": 800,\r\n                  \"default_link\": true,\r\n                  \"backup_link\": false,\r\n                  \"preferred_breakout_link\": true,\r\n                  \"subscribed_bandwidth\": 100,\r\n                  \"enable_pppoe\": false,\r\n                  \"exclusive_for_local_breakout\": false\r\n                },\r\n                {\r\n                  \"wan_link\": \"WAN_1\",\r\n                  \"wan_link_type\": \"MPLS\",\r\n                  \"cost_currency\": \"USD\",\r\n                  \"access_type\": \"Ethernet\",\r\n                  \"local_breakout_enabled\": true,\r\n                  \"provider\": \"ISP2\",\r\n                  \"cost\": 800,\r\n                  \"default_link\": false,\r\n                  \"backup_link\": true,\r\n                  \"preferred_breakout_link\": false,\r\n                  \"subscribed_bandwidth\": 1000,\r\n                  \"enable_pppoe\": false,\r\n                  \"exclusive_for_local_breakout\": false\r\n                }\r\n              ],\r\n              \"lan_segment\": [\r\n                {\r\n                  \"isUpdate\": false,\r\n                  \"overlay_vpn\": true,\r\n                  \"name\": \"IoT_StoreOps\",\r\n                  \"cpe_port\": \"ge-0/0/2\",\r\n                  \"vlan\": 40,\r\n                  \"native_vlan\": false,\r\n                  \"ip_subnet\": \"192.168.18.209/28\",\r\n                  \"department\": \"PublicINET\",\r\n                  \"zone_text\": \"PublicINET\",\r\n                  \"dhcp\": true,\r\n                  \"additional_config\": {\r\n                    \"dhcp\": {\r\n                      \"range_low\": \"192.168.18.210\",\r\n                      \"range_high\": \"192.168.18.212\",\r\n                      \"max_lease_time\": 86400,\r\n                      \"name_server\": [\r\n                        \"8.8.8.8\"\r\n                      ],\r\n                      \"subnet\": \"192.168.18.209/28\"\r\n                    }\r\n                  },\r\n                  \"routing_segment\": false,\r\n                  \"no_overlay_advertise\": true,\r\n                  \"lan_segment_name\": \"IoT_StoreOps\",\r\n                  \"lan_ports\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"interface_names\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"ip_prefix\": \"192.168.18.209/28\"\r\n                },\r\n                {\r\n                  \"isUpdate\": false,\r\n                  \"overlay_vpn\": true,\r\n                  \"name\": \"Production\",\r\n                  \"cpe_port\": \"ge-0/0/2\",\r\n                  \"vlan\": 20,\r\n                  \"native_vlan\": false,\r\n                  \"ip_subnet\": \"192.70.2.50/24\",\r\n                  \"department\": \"Business\",\r\n                  \"zone_text\": \"Business\",\r\n                  \"dhcp\": false,\r\n                  \"routing_segment\": false,\r\n                  \"no_overlay_advertise\": true,\r\n                  \"additional_routes\": [\r\n                    \"10.242.67.254/25\"\r\n                  ],\r\n                  \"lan_segment_name\": \"Production\",\r\n                  \"lan_ports\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"interface_names\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"ip_prefix\": \"192.70.2.50/24\"\r\n                },\r\n                {\r\n                  \"isUpdate\": false,\r\n                  \"overlay_vpn\": true,\r\n                  \"name\": \"Production_NAT\",\r\n                  \"cpe_port\": \"ge-0/0/2\",\r\n                  \"vlan\": 21,\r\n                  \"native_vlan\": false,\r\n                  \"ip_subnet\": \"10.242.67.254/25\",\r\n                  \"department\": \"Business\",\r\n                  \"zone_text\": \"Business\",\r\n                  \"dhcp\": false,\r\n                  \"routing_segment\": false,\r\n                  \"no_overlay_advertise\": true,\r\n                  \"lan_segment_name\": \"Production_NAT\",\r\n                  \"lan_ports\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"interface_names\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"ip_prefix\": \"10.242.67.254/25\"\r\n                },\r\n                {\r\n                  \"isUpdate\": true,\r\n                  \"overlay_vpn\": true,\r\n                  \"name\": \"InfraMgmt\",\r\n                  \"cpe_port\": \"ge-0/0/2\",\r\n                  \"vlan\": 1,\r\n                  \"native_vlan\": true,\r\n                  \"ip_subnet\": \"10.253.0.241/28\",\r\n                  \"department\": \"InfraMgmt\",\r\n                  \"zone_text\": \"InfraMgmt\",\r\n                  \"dhcp\": true,\r\n                  \"additional_config\": {\r\n                    \"dhcp\": {\r\n                      \"range_low\": \"10.253.0.242\",\r\n                      \"range_high\": \"10.253.0.244\",\r\n                      \"max_lease_time\": 86400,\r\n                      \"name_server\": [\r\n                        \"8.8.8.8\"\r\n                      ],\r\n                      \"subnet\": \"10.253.0.241/28\"\r\n                    }\r\n                  },\r\n                  \"routing_segment\": false,\r\n                  \"no_overlay_advertise\": true,\r\n                  \"lan_segment_name\": \"InfraMgmt\",\r\n                  \"lan_ports\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"interface_names\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"ip_prefix\": \"10.253.0.241/28\"\r\n                },\r\n                {\r\n                  \"isUpdate\": false,\r\n                  \"overlay_vpn\": true,\r\n                  \"name\": \"ThirdParty\",\r\n                  \"cpe_port\": \"ge-0/0/2\",\r\n                  \"vlan\": 50,\r\n                  \"native_vlan\": false,\r\n                  \"ip_subnet\": \"172.20.4.97/29\",\r\n                  \"department\": \"Partner\",\r\n                  \"zone_text\": \"Partner\",\r\n                  \"dhcp\": false,\r\n                  \"routing_segment\": false,\r\n                  \"no_overlay_advertise\": true,\r\n                  \"lan_segment_name\": \"ThirdParty\",\r\n                  \"lan_ports\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"interface_names\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"ip_prefix\": \"172.20.4.97/29\"\r\n                },\r\n                {\r\n                  \"isUpdate\": false,\r\n                  \"overlay_vpn\": true,\r\n                  \"name\": \"GuestWIFI\",\r\n                  \"cpe_port\": \"ge-0/0/2\",\r\n                  \"vlan\": 254,\r\n                  \"native_vlan\": false,\r\n                  \"ip_subnet\": \"192.168.254.1/23\",\r\n                  \"department\": \"PublicINET\",\r\n                  \"zone_text\": \"PublicINET\",\r\n                  \"dhcp\": true,\r\n                  \"additional_config\": {\r\n                    \"dhcp\": {\r\n                      \"range_low\": \"192.168.254.2\",\r\n                      \"range_high\": \"192.168.255.254\",\r\n                      \"max_lease_time\": 86400,\r\n                      \"name_server\": [\r\n                        \"8.8.8.8\"\r\n                      ],\r\n                      \"subnet\": \"192.168.254.1/23\"\r\n                    }\r\n                  },\r\n                  \"routing_segment\": false,\r\n                  \"no_overlay_advertise\": true,\r\n                  \"lan_segment_name\": \"GuestWIFI\",\r\n                  \"lan_ports\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"interface_names\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"ip_prefix\": \"192.168.254.1/23\"\r\n                },\r\n                {\r\n                  \"isUpdate\": false,\r\n                  \"overlay_vpn\": true,\r\n                  \"name\": \"IoTWIFI_MPSK0\",\r\n                  \"cpe_port\": \"ge-0/0/2\",\r\n                  \"vlan\": 140,\r\n                  \"native_vlan\": false,\r\n                  \"ip_subnet\": \"192.168.140.1/24\",\r\n                  \"department\": \"PublicINET\",\r\n                  \"zone_text\": \"PublicINET\",\r\n                  \"dhcp\": true,\r\n                  \"additional_config\": {\r\n                    \"dhcp\": {\r\n                      \"range_low\": \"192.168.140.2\",\r\n                      \"range_high\": \"192.168.140.254\",\r\n                      \"max_lease_time\": 86400,\r\n                      \"name_server\": [\r\n                        \"8.8.8.8\"\r\n                      ],\r\n                      \"subnet\": \"192.168.140.1/24\"\r\n                    }\r\n                  },\r\n                  \"routing_segment\": false,\r\n                  \"no_overlay_advertise\": true,\r\n                  \"lan_segment_name\": \"IoTWIFI_MPSK0\",\r\n                  \"lan_ports\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"interface_names\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"ip_prefix\": \"192.168.140.1/24\"\r\n                },\r\n                {\r\n                  \"isUpdate\": false,\r\n                  \"overlay_vpn\": true,\r\n                  \"name\": \"IoIWIFI_MPSK1\",\r\n                  \"cpe_port\": \"ge-0/0/2\",\r\n                  \"vlan\": 141,\r\n                  \"native_vlan\": false,\r\n                  \"ip_subnet\": \"192.168.141.1/24\",\r\n                  \"department\": \"PublicINET\",\r\n                  \"zone_text\": \"PublicINET\",\r\n                  \"dhcp\": true,\r\n                  \"additional_config\": {\r\n                    \"dhcp\": {\r\n                      \"range_low\": \"192.168.141.2\",\r\n                      \"range_high\": \"192.168.141.254\",\r\n                      \"max_lease_time\": 86400,\r\n                      \"name_server\": [\r\n                        \"8.8.8.8\"\r\n                      ],\r\n                      \"subnet\": \"192.168.141.1/24\"\r\n                    }\r\n                  },\r\n                  \"routing_segment\": false,\r\n                  \"no_overlay_advertise\": true,\r\n                  \"lan_segment_name\": \"IoIWIFI_MPSK1\",\r\n                  \"lan_ports\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"interface_names\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"ip_prefix\": \"192.168.141.1/24\"\r\n                },\r\n                {\r\n                  \"isUpdate\": false,\r\n                  \"overlay_vpn\": true,\r\n                  \"name\": \"IoIWIFI_MPSK2\",\r\n                  \"cpe_port\": \"ge-0/0/2\",\r\n                  \"vlan\": 142,\r\n                  \"native_vlan\": false,\r\n                  \"ip_subnet\": \"192.168.142.1/24\",\r\n                  \"department\": \"PublicINET\",\r\n                  \"zone_text\": \"PublicINET\",\r\n                  \"dhcp\": true,\r\n                  \"additional_config\": {\r\n                    \"dhcp\": {\r\n                      \"range_low\": \"192.168.142.2\",\r\n                      \"range_high\": \"192.168.142.254\",\r\n                      \"max_lease_time\": 86400,\r\n                      \"name_server\": [\r\n                        \"8.8.8.8\"\r\n                      ],\r\n                      \"subnet\": \"192.168.142.1/24\"\r\n                    }\r\n                  },\r\n                  \"routing_segment\": false,\r\n                  \"no_overlay_advertise\": true,\r\n                  \"lan_segment_name\": \"IoIWIFI_MPSK2\",\r\n                  \"lan_ports\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"interface_names\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"ip_prefix\": \"192.168.142.1/24\"\r\n                },\r\n                {\r\n                  \"isUpdate\": false,\r\n                  \"overlay_vpn\": true,\r\n                  \"name\": \"IoIWIFI_MPSK3\",\r\n                  \"cpe_port\": \"ge-0/0/2\",\r\n                  \"vlan\": 143,\r\n                  \"native_vlan\": false,\r\n                  \"ip_subnet\": \"192.168.143.1/24\",\r\n                  \"department\": \"PublicINET\",\r\n                  \"zone_text\": \"PublicINET\",\r\n                  \"dhcp\": true,\r\n                  \"additional_config\": {\r\n                    \"dhcp\": {\r\n                      \"range_low\": \"192.168.143.2\",\r\n                      \"range_high\": \"192.168.143.254\",\r\n                      \"max_lease_time\": 86400,\r\n                      \"name_server\": [\r\n                        \"8.8.8.8\"\r\n                      ],\r\n                      \"subnet\": \"192.168.143.1/24\"\r\n                    }\r\n                  },\r\n                  \"routing_segment\": false,\r\n                  \"no_overlay_advertise\": true,\r\n                  \"lan_segment_name\": \"IoIWIFI_MPSK3\",\r\n                  \"lan_ports\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"interface_names\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"ip_prefix\": \"192.168.143.1/24\"\r\n                },\r\n                {\r\n                  \"isUpdate\": false,\r\n                  \"overlay_vpn\": true,\r\n                  \"name\": \"IoIWIFI_MPSK4\",\r\n                  \"cpe_port\": \"ge-0/0/2\",\r\n                  \"vlan\": 144,\r\n                  \"native_vlan\": false,\r\n                  \"ip_subnet\": \"192.168.144.1/24\",\r\n                  \"department\": \"PublicINET\",\r\n                  \"zone_text\": \"PublicINET\",\r\n                  \"dhcp\": true,\r\n                  \"additional_config\": {\r\n                    \"dhcp\": {\r\n                      \"range_low\": \"192.168.144.2\",\r\n                      \"range_high\": \"192.168.144.254\",\r\n                      \"max_lease_time\": 86400,\r\n                      \"name_server\": [\r\n                        \"8.8.8.8\"\r\n                      ],\r\n                      \"subnet\": \"192.168.144.1/24\"\r\n                    }\r\n                  },\r\n                  \"routing_segment\": false,\r\n                  \"no_overlay_advertise\": true,\r\n                  \"lan_segment_name\": \"IoIWIFI_MPSK4\",\r\n                  \"lan_ports\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"interface_names\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"ip_prefix\": \"192.168.144.1/24\"\r\n                },\r\n                {\r\n                  \"isUpdate\": false,\r\n                  \"overlay_vpn\": true,\r\n                  \"name\": \"IoIWIFI_MPSK5\",\r\n                  \"cpe_port\": \"ge-0/0/2\",\r\n                  \"vlan\": 145,\r\n                  \"native_vlan\": false,\r\n                  \"ip_subnet\": \"192.168.145.1/24\",\r\n                  \"department\": \"PublicINET\",\r\n                  \"zone_text\": \"PublicINET\",\r\n                  \"dhcp\": true,\r\n                  \"additional_config\": {\r\n                    \"dhcp\": {\r\n                      \"range_low\": \"192.168.145.2\",\r\n                      \"range_high\": \"192.168.145.254\",\r\n                      \"max_lease_time\": 86400,\r\n                      \"name_server\": [\r\n                        \"8.8.8.8\"\r\n                      ],\r\n                      \"subnet\": \"192.168.145.1/24\"\r\n                    }\r\n                  },\r\n                  \"routing_segment\": false,\r\n                  \"no_overlay_advertise\": true,\r\n                  \"lan_segment_name\": \"IoIWIFI_MPSK5\",\r\n                  \"lan_ports\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"interface_names\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"ip_prefix\": \"192.168.145.1/24\"\r\n                },\r\n                {\r\n                  \"isUpdate\": false,\r\n                  \"overlay_vpn\": true,\r\n                  \"name\": \"IoIWIFI_MPSK6\",\r\n                  \"cpe_port\": \"ge-0/0/2\",\r\n                  \"vlan\": 146,\r\n                  \"native_vlan\": false,\r\n                  \"ip_subnet\": \"192.168.146.1/24\",\r\n                  \"department\": \"PublicINET\",\r\n                  \"zone_text\": \"PublicINET\",\r\n                  \"dhcp\": true,\r\n                  \"additional_config\": {\r\n                    \"dhcp\": {\r\n                      \"range_low\": \"192.168.146.2\",\r\n                      \"range_high\": \"192.168.146.254\",\r\n                      \"max_lease_time\": 86400,\r\n                      \"name_server\": [\r\n                        \"8.8.8.8\"\r\n                      ],\r\n                      \"subnet\": \"192.168.146.1/24\"\r\n                    }\r\n                  },\r\n                  \"routing_segment\": false,\r\n                  \"no_overlay_advertise\": true,\r\n                  \"lan_segment_name\": \"IoIWIFI_MPSK6\",\r\n                  \"lan_ports\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"interface_names\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"ip_prefix\": \"192.168.146.1/24\"\r\n                },\r\n                {\r\n                  \"isUpdate\": false,\r\n                  \"overlay_vpn\": true,\r\n                  \"name\": \"IoIWIFI_MPSK7\",\r\n                  \"cpe_port\": \"ge-0/0/2\",\r\n                  \"vlan\": 147,\r\n                  \"native_vlan\": false,\r\n                  \"ip_subnet\": \"192.168.147.1/24\",\r\n                  \"department\": \"PublicINET\",\r\n                  \"zone_text\": \"PublicINET\",\r\n                  \"dhcp\": true,\r\n                  \"additional_config\": {\r\n                    \"dhcp\": {\r\n                      \"range_low\": \"192.168.147.2\",\r\n                      \"range_high\": \"192.168.147.254\",\r\n                      \"max_lease_time\": 86400,\r\n                      \"name_server\": [\r\n                        \"8.8.8.8\"\r\n                      ],\r\n                      \"subnet\": \"192.168.147.1/24\"\r\n                    }\r\n                  },\r\n                  \"routing_segment\": false,\r\n                  \"no_overlay_advertise\": true,\r\n                  \"lan_segment_name\": \"IoIWIFI_MPSK7\",\r\n                  \"lan_ports\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"interface_names\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"ip_prefix\": \"192.168.147.1/24\"\r\n                },\r\n                {\r\n                  \"isUpdate\": false,\r\n                  \"overlay_vpn\": true,\r\n                  \"name\": \"IoIWIFI_MPSK8\",\r\n                  \"cpe_port\": \"ge-0/0/2\",\r\n                  \"vlan\": 148,\r\n                  \"native_vlan\": false,\r\n                  \"ip_subnet\": \"192.168.148.1/24\",\r\n                  \"department\": \"PublicINET\",\r\n                  \"zone_text\": \"PublicINET\",\r\n                  \"dhcp\": true,\r\n                  \"additional_config\": {\r\n                    \"dhcp\": {\r\n                      \"range_low\": \"192.168.148.2\",\r\n                      \"range_high\": \"192.168.148.254\",\r\n                      \"max_lease_time\": 86400,\r\n                      \"name_server\": [\r\n                        \"8.8.8.8\"\r\n                      ],\r\n                      \"subnet\": \"192.168.148.1/24\"\r\n                    }\r\n                  },\r\n                  \"routing_segment\": false,\r\n                  \"no_overlay_advertise\": true,\r\n                  \"lan_segment_name\": \"IoIWIFI_MPSK8\",\r\n                  \"lan_ports\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"interface_names\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"ip_prefix\": \"192.168.148.1/24\"\r\n                },\r\n                {\r\n                  \"isUpdate\": false,\r\n                  \"overlay_vpn\": true,\r\n                  \"name\": \"IoIWIFI_MPSK9\",\r\n                  \"cpe_port\": \"ge-0/0/2\",\r\n                  \"vlan\": 149,\r\n                  \"native_vlan\": false,\r\n                  \"ip_subnet\": \"192.168.149.1/24\",\r\n                  \"department\": \"PublicINET\",\r\n                  \"zone_text\": \"PublicINET\",\r\n                  \"dhcp\": true,\r\n                  \"additional_config\": {\r\n                    \"dhcp\": {\r\n                      \"range_low\": \"192.168.149.2\",\r\n                      \"range_high\": \"192.168.149.254\",\r\n                      \"max_lease_time\": 86400,\r\n                      \"name_server\": [\r\n                        \"8.8.8.8\"\r\n                      ],\r\n                      \"subnet\": \"192.168.149.1/24\"\r\n                    }\r\n                  },\r\n                  \"routing_segment\": false,\r\n                  \"no_overlay_advertise\": true,\r\n                  \"lan_segment_name\": \"IoIWIFI_MPSK9\",\r\n                  \"lan_ports\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"interface_names\": [\r\n                    \"ge-0/0/2\"\r\n                  ],\r\n                  \"ip_prefix\": \"192.168.149.1/24\"\r\n                }\r\n              ]\r\n            }\r\n          ],\r\n          \"dvpn_params\": {\r\n            \"create_dvpn_threshold\": \"5\",\r\n            \"delete_dvpn_threshold\": \"2\"\r\n          },\r\n          \"site_deployment_capabilities\": [\r\n            \"SDWAN\"\r\n          ]\r\n        },\r\n        \"properties\": {\r\n          \"property\": [\r\n            {\r\n              \"name\": \"site_advanced_config\",\r\n              \"value\": {\r\n                \"nameserver\": [\r\n                  \"8.8.8.8\",\r\n                  \"8.8.4.4\"\r\n                ],\r\n                \"ntpserver\": \"216.239.35.4\",\r\n                \"timezone\": \"America/Los_Angeles\"\r\n              }\r\n            }\r\n          ]\r\n        },\r\n        \"on_premise_site_info\": {\r\n          \"site_role\": \"spoke\",\r\n          \"ha_info\": {\r\n            \"ha_topology\": \"STANDALONE\"\r\n          },\r\n          \"service_level\": \"ADVANCED\",\r\n          \"device\": [\r\n            {\r\n              \"device_name\": \"{{site_name}}\",\r\n              \"device_template\": \"OpenLab/POC_SRX_CPE\",\r\n              \"device_details\": {\r\n                \"device_family\": \"juniper-srx\",\r\n                \"device_model\": \"vSRX\",\r\n                \"serial_number\": \"438771baf044\",\r\n                \"root_password\": \"$1$X.14$pUcfiYCsZtrLaMHE1FYYO/\",\r\n                \"ztp\": true,\r\n                \"auto_activate\": true,\r\n                \"management_connectivity\": {\r\n                  \"address_family\": [\r\n                    \"IPV4\"\r\n                  ]\r\n                },\r\n                \"boot_image\": \"\"\r\n              },\r\n              \"device_host_name\": \"OpenLab.{{site_name}}\",\r\n              \"oam_traffic\": {},\r\n              \"dvpn_params\": {\r\n                \"create_dvpn_threshold\": 5,\r\n                \"delete_dvpn_threshold\": 2\r\n              },\r\n              \"wan_link\": [\r\n                {\r\n                  \"wan_link_name\": \"WAN_0\",\r\n                  \"local_interface\": \"ge-0/0/0\",\r\n                  \"wan_link_type\": \"Internet\",\r\n                  \"access_type\": \"Ethernet\",\r\n                  \"enable_ipv4\": true,\r\n                  \"address_assignment\": \"DHCP\",\r\n                  \"enable_ipv6\": false,\r\n                  \"tunnel_underlay_family\": \"IPV4\",\r\n                  \"local_breakout_enabled\": true,\r\n                  \"nat_info\": {\r\n                    \"nat_enabled\": true,\r\n                    \"source_nat_interface_based\": true\r\n                  },\r\n                  \"preferred_breakout_link\": true,\r\n                  \"bgp_info\": false,\r\n                  \"used_for_meshing\": false,\r\n                  \"used_for_oam\": true,\r\n                  \"connect_to_ehubs\": true,\r\n                  \"ehub_overlay_tunnel\": [\r\n                    {\r\n                      \"tunnel_id\": 0,\r\n                      \"tunnel_endpoint_role\": \"SPOKE\",\r\n                      \"tunnel_type\": \"GRE_IPSEC\",\r\n                      \"peer_info\": {\r\n                        \"peer_device\": \"D1P1-E-HUB-1-SRX4200\",\r\n                        \"interface_names\": [\r\n                          \"WAN_0\"                          \r\n                        ]\r\n                      }\r\n                    },\r\n                    {\r\n                      \"tunnel_id\": 1,\r\n                      \"tunnel_endpoint_role\": \"SPOKE\",\r\n                      \"tunnel_type\": \"GRE_IPSEC\",\r\n                      \"peer_info\": {\r\n                        \"peer_device\": \"D1P1-E-HUB-2-SRX4200\",\r\n                        \"interface_names\": [\r\n                          \"WAN_0\"                          \r\n                        ]\r\n                      }\r\n                    }\r\n                  ],\r\n                  \"traffic_type\": \"DATA_ONLY\",\r\n                  \"backup_link\": false,\r\n                  \"default_link\": true,\r\n                  \"vpn\": [\r\n                    {\r\n                      \"vpn_name\": \"OpenLab_DefaultVPN\"\r\n                    }\r\n                  ]\r\n                },\r\n                {\r\n                  \"wan_link_name\": \"WAN_1\",\r\n                  \"local_interface\": \"ge-0/0/1\",\r\n                  \"wan_link_type\": \"MPLS\",\r\n                  \"access_type\": \"Ethernet\",\r\n                  \"enable_ipv4\": true,\r\n                  \"address_assignment\": \"DHCP\",\r\n                  \"enable_ipv6\": false,\r\n                  \"tunnel_underlay_family\": \"IPV4\",\r\n                  \"local_breakout_enabled\": true,\r\n                  \"nat_info\": {\r\n                    \"nat_enabled\": true,\r\n                    \"source_nat_interface_based\": true\r\n                  },\r\n                  \"preferred_breakout_link\": false,\r\n                  \"bgp_info\": false,\r\n                  \"used_for_meshing\": false,\r\n                  \"used_for_oam\": true,\r\n                  \"connect_to_ehubs\": true,\r\n                  \"ehub_overlay_tunnel\": [\r\n                    {\r\n                      \"tunnel_id\": 0,\r\n                      \"tunnel_endpoint_role\": \"SPOKE\",\r\n                      \"tunnel_type\": \"GRE_IPSEC\",\r\n                      \"peer_info\": {\r\n                        \"peer_device\": \"D1P1-E-HUB-1-SRX4200\",\r\n                        \"interface_names\": [\r\n                          \"WAN_1\"                          \r\n                        ]\r\n                      }\r\n                    },\r\n                    {\r\n                      \"tunnel_id\": 1,\r\n                      \"tunnel_endpoint_role\": \"SPOKE\",\r\n                      \"tunnel_type\": \"GRE_IPSEC\",\r\n                      \"peer_info\": {\r\n                        \"peer_device\": \"D1P1-E-HUB-2-SRX4200\",\r\n                        \"interface_names\": [\r\n                          \"WAN_1\"                          \r\n                        ]\r\n                      }\r\n                    }\r\n                  ],\r\n                  \"traffic_type\": \"DATA_ONLY\",\r\n                  \"backup_link\": true,\r\n                  \"default_link\": false,\r\n                  \"vpn\": [\r\n                    {\r\n                      \"vpn_name\": \"OpenLab_DefaultVPN\"\r\n                    }\r\n                  ]\r\n                }\r\n              ],\r\n              \"config_templates\": [\r\n                \"Production-NAT\",\r\n                \"MIST-WA-SRX-OpenLab\"\r\n              ],\r\n              \"template_mappings\": [\r\n                {\r\n                  \"template_uuid\": \"45bcee43-c7e4-4b19-a655-92a44adf6018\",\r\n                  \"component\": \"JUNOS\",\r\n                  \"template_fq_name\": [\r\n                    \"default-domain\",\r\n                    \"OpenLab\",\r\n                    \"Production-NAT\"\r\n                  ],\r\n                  \"template_name\": \"Production-NAT\",\r\n                  \"template_display_name\": \"Production-NAT\",\r\n                  \"hide\": false,\r\n                  \"initial_config\": {\r\n                    \"ztp\": true,\r\n                    \"configuration\": {\r\n                      \"enable_NAT\": true,\r\n                      \"POS_CONFIG\": [\r\n                        {\r\n                          \"IP\": \"192.70.2.1\",\r\n                          \"NAT_IP\": \"10.242.67.128\",\r\n                          \"LAN_zone\": \"Business\"\r\n                        },\r\n                        {\r\n                          \"IP\": \"192.70.2.2\",\r\n                          \"NAT_IP\": \"10.242.67.129\",\r\n                          \"LAN_zone\": \"Business\"\r\n                        },\r\n                        {\r\n                          \"IP\": \"192.70.2.3\",\r\n                          \"NAT_IP\": \"10.242.67.130\",\r\n                          \"LAN_zone\": \"Business\"\r\n                        },\r\n                        {\r\n                          \"IP\": \"192.70.2.4\",\r\n                          \"NAT_IP\": \"10.242.67.140\",\r\n                          \"LAN_zone\": \"Business\"\r\n                        },\r\n                        {\r\n                          \"IP\": \"192.70.2.100\",\r\n                          \"NAT_IP\": \"10.242.67.200\",\r\n                          \"LAN_zone\": \"Business\"\r\n                        },\r\n                        {\r\n                          \"IP\": \"192.70.2.20\",\r\n                          \"NAT_IP\": \"10.242.67.220\",\r\n                          \"LAN_zone\": \"Business\"\r\n                        },\r\n                        {\r\n                          \"IP\": \"192.70.2.14\",\r\n                          \"NAT_IP\": \"10.242.67.214\",\r\n                          \"LAN_zone\": \"Business\"\r\n                        },\r\n                        {\r\n                          \"IP\": \"192.70.2.15\",\r\n                          \"NAT_IP\": \"10.242.67.215\",\r\n                          \"LAN_zone\": \"Business\"\r\n                        },\r\n                        {\r\n                          \"IP\": \"192.70.2.16\",\r\n                          \"NAT_IP\": \"10.242.67.216\",\r\n                          \"LAN_zone\": \"Business\"\r\n                        },\r\n                        {\r\n                          \"IP\": \"192.70.2.17\",\r\n                          \"NAT_IP\": \"10.242.67.217\",\r\n                          \"LAN_zone\": \"Business\"\r\n                        },\r\n                        {\r\n                          \"IP\": \"192.70.2.18\",\r\n                          \"NAT_IP\": \"10.242.67.218\",\r\n                          \"LAN_zone\": \"Business\"\r\n                        }\r\n                      ],\r\n                      \"timestamp\": 1631087390785,\r\n                      \"device_id\": \"_ztp_none_device_id\"\r\n                    }\r\n                  }\r\n                },\r\n                {\r\n                  \"template_uuid\": \"3d9a11ba-a122-4d95-8a4d-d80d8e1517a4\",\r\n                  \"component\": \"JUNOS\",\r\n                  \"template_fq_name\": [\r\n                    \"default-domain\",\r\n                    \"OpenLab\",\r\n                    \"MIST-WA-SRX-OpenLab\"\r\n                  ],\r\n                  \"template_name\": \"MIST-WA-SRX-OpenLab\",\r\n                  \"template_display_name\": \"MIST-WA-SRX-OpenLab\",\r\n                  \"hide\": false,\r\n                  \"initial_config\": {\r\n                    \"ztp\": true,\r\n                    \"configuration\": {\r\n                      \"Enable_WanAssurance\": true,\r\n                      \"mist_secret\": \"170c843f43cf23e4fef114d2761ac63e2591977dab99b5483906062554a0ec17a89541e1cd1b3b4ade7a6c8df620d147a955477bee7d9331efe7bd74fec69096\",\r\n                      \"encrypted_password\": \"$6$XlkJFUAHFnWe0aig$qre38oAd.oqdnAtQ0y.zhFCK/f5.VRKvlAyCY0llU0WSWkzsJbxqcQ6Vd0KEXzhY.nbuEn8/kj5qOAouXKpnZ.\",\r\n                      \"mist_device_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\r\n                      \"timestamp\": 1643911540393,\r\n                      \"device_id\": \"_ztp_none_device_id\"\r\n                    }\r\n                  }\r\n                }\r\n              ],\r\n              \"device_role\": \"SDWAN\"\r\n            }\r\n          ],\r\n          \"region\": \"regional\",\r\n          \"gateway_sites\": [\r\n            {\r\n              \"gateway_name\": \"D1P1-E-HUB-1-SRX4200\",\r\n              \"gateway_role\": \"PRIMARY_GW\"\r\n            },\r\n            {\r\n              \"gateway_name\": \"D1P1-E-HUB-2-SRX4200\",\r\n              \"gateway_role\": \"SECONDARY_GW\"\r\n            }\r\n          ]\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}"
				},
				"url": {
					"raw": "{{base_url}}/tssm/configure-sites",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"tssm",
						"configure-sites"
					]
				}
			},
			"response": []
		},
		{
			"name": "CSO-job_status",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// ToDo:",
							"// - after that check for Deploy Configuration to Device PB-Abuse-SRX",
							"//",
							"",
							"// To improve ",
							"// - if provision job fails, retry them once or twice",
							"// - if job failed, look again untill current time to see if it was restarted again. ( if above was not implemented)",
							"// - if WAN_0 or only WAN_1 successfull ",
							"",
							"// JOB id of AUTO_SDWAN policy : 9687003b-aa33-4e52-bf06-ef29f69b0351",
							"// JOB id of AUTO_AUTONAT policy : bd206b9b-de66-4997-88b9-ce75b558cee7",
							"// JOb if of AUTO_FW policy : 8163de0c-ac09-42a6-94ad-ce6875d6fb0b",
							"// JOB id of Service provisioning : 0c8e8633-a7f5-48be-8c35-796330723a95",
							"// JOB id of DHCP update: 96fa84f8-a134-403f-83f5-b778f49a715a",
							"// JOB id of Deleting site: a4642c01-374a-44cc-9f65-b0cfa9bb1f16",
							"",
							"/* ",
							"1. Configure Spoke Site PBSC-Site-1 : d779d3d3-e030-4a9b-8710-20d365f737fc",
							"2. Bootstrap Device PBSC-Site-1 : 0df01e91-d8eb-46df-9169-58d2fb9f23ab",
							"3. Zero Touch Provisioning PBSC-Site-1 : 442a2ef1-7ae4-4024-ad59-8aad226c0b1e",
							"4. Service Provisioning PBSC-Site-1 : f78ba28c-3c60-4b64-930c-2fed865833d2",
							"   End: Nov 19, 2021, 4:00:54 PM",
							"5. AUTO_SDWAN_policy_ : 485a15e3-4925-4c5e-b101-e084a9c0641b",
							"    Start: Nov 19, 2021, 4:01:24 PM",
							"    CHild Job with name PBSC-Site-1 must be sucessfull",
							"    ie Task: Deployment Task/SDWAN policy deployment on device PBSC-Site-13/device_config_push",
							"",
							"   AUTO_NAT: 44db6462-2a47-44bb-9427-c00616ff2e6e",
							"    Start Time: Nov 19, 2021, 4:02:36 PM",
							"    MUST be sucessfull",
							"",
							"  AUTO_FW policy : 1f80253d-45cf-44bf-89fa-c81ef18657d3",
							"    start Time: Nov 19, 2021, 4:07:29 PM",
							"    Site PBSC-Site-1 must be sucessfull ",
							"*/",
							"var jsonData = JSON.parse(responseBody);",
							"var moment = require('moment');",
							"var jsonData = jsonData.job;",
							"var jobs = pm.collectionVariables.get(\"jobs\");",
							"var end_time = moment.unix(jsonData.end_time).format('llll');",
							"var five_min_ago = moment().subtract(5, 'minutes').unix();",
							"var site_name = pm.environment.get('site_name');",
							"nextRequest = null;",
							"",
							"/*",
							"// DEBUG - list all collection variables",
							"console.log('---------  DEBUG ----');",
							"if(jobs && JSON.parse(jobs).length > 0) {",
							"    console.log('Jobs length parse', JSON.parse(jobs).length);",
							"}",
							"//console.log(jsonData);",
							"function list_all() {",
							"    const each = _.keys(pm.collectionVariables.toObject())",
							"    _.each(each, (arrItem) => {",
							"        console.log(`${arrItem} value: `, pm.collectionVariables.get(arrItem));",
							"    })",
							"}",
							"console.log(list_all());",
							"console.log('------  DEBUG-END ----');",
							"*/",
							"",
							"status = jsonData.status;",
							"uuid = jsonData.uuid;",
							"// AUTO-SD-WAN job does nto seems to have results property ",
							"if (!jsonData.results) {",
							"    results = 'undefined';",
							"} else {",
							"    results = jsonData.results;",
							"}",
							"",
							"//console.log(`Status ... job: ${jsonData.display_name} is in ${status}`);",
							"if (typeof jsonData['request_id'] != 'undefined') {",
							"    pm.collectionVariables.set('x_request_id',jsonData['request_id']);",
							"    //console.log(`- x-reuest-id : ${pm.collectionVariables.get('x_request_id')}`);",
							"}",
							"",
							"if(jobs && jobs.length > 2) {",
							"    nextRequest = 'CSO-job_status';",
							"}",
							"else {",
							"    if (pm.collectionVariables.get('AUTO_NAT') != true || pm.collectionVariables.get('AUTO_FW') != true || pm.collectionVariables.get('AUTO_SDWAN') != true) {",
							"       nextRequest = 'CSO-get_jobs';",
							"       console.log('Not quite done, need to get more jobs ...');",
							"    }",
							"}",
							"",
							"var maxNumberOfTries = 10; // your max number of tries",
							"var sleepBetweenTries = 300000; // your interval between attempts in milisecond seconds",
							"",
							"//",
							"// IF Completly provisioned incdluing NAT, SD-WAN and FW",
							"//",
							"//if (pm.collectionVariables.get('AUTO_NAT') == true && pm.collectionVariables.get('AUTO_FW') == true && pm.collectionVariables.get('AUTO_SDWAN') == true && pm.collectionVariables.get('DHCP_WAN_0') == true && pm.collectionVariables.get('DHCP_WAN_1') == true) {",
							"if (pm.collectionVariables.get('AUTO_NAT') == true && pm.collectionVariables.get('AUTO_FW') == true && pm.collectionVariables.get('AUTO_SDWAN') == true && (pm.collectionVariables.get('DHCP_WAN_0') != true || pm.collectionVariables.get('DHCP_WAN_1') != true)) {",
							"    var auto_complete = true;",
							"    pm.collectionVariables.set('job_search_start_time', pm.collectionVariables.get('service_provisioning_end_time'));",
							"    pm.collectionVariables.set('job_search_regex','.*DHCP Update for WAN.[0,1] of ' + site_name);",
							"    console.log('Site AUTO_NAT,AUTO_FW and AUTO_SDWAN sucessfully provisioned .... next checking DHCP Update');",
							"    //In case job finished more than 5 minutes ago, no need to wait unlike real-time deployemtn",
							"    if (five_min_ago < jsonData.end_time) {",
							"        setTimeout(function() {}, 120000); // sleep two minutes and search for Service provision job ID",
							"    }",
							"    nextRequest = 'CSO-get_jobs';",
							"}",
							"",
							"if (pm.collectionVariables.get('DHCP_WAN_0') == true && pm.collectionVariables.get('DHCP_WAN_1') == true && pm.collectionVariables.get('AUTO_NAT') == true && pm.collectionVariables.get('AUTO_FW') == true && pm.collectionVariables.get('AUTO_SDWAN') == true) {",
							"    console.log(\"FIRST IF LOOP ....\")",
							"    if (pm.collectionVariables.get('DHCP_WAN_0') == true && pm.collectionVariables.get('DHCP_WAN_1') == true){ ",
							"        var complete = true;",
							"        console.log('Site sucessfully provisioned .... next checking MIST org');",
							"        pm.test(` Site ${site_name} was sucessfully provisioned ....`, function () {",
							"            pm.expect(complete).to.equal(true);",
							"        });      ",
							"        nextRequest = 'MIST-org_sites';",
							"    }",
							"}",
							"else {",
							"    console.log(\"FIRST ELSE LOOP looking deeper....\")",
							"    // ",
							"    //.   IN-PROGRESS",
							"    //",
							"",
							"    // If this is the first time in loop",
							"    if ((status === 'unknown' || status === 'in-progress' || results.length === 0) && (!pm.collectionVariables.get(\"tries\"))) { ",
							"        pm.collectionVariables.set(\"tries\", 1); ",
							"        console.log('Setting variable tries to 1');",
							"    }",
							"    // handling extremly long jobs untill tey eventually time out by CSO and become failed.",
							"    if ((status === 'unknown' || status === 'in-progress' || results.length === 0) && (pm.collectionVariables.get(\"tries\") === maxNumberOfTries)) {",
							"        pm.test.skip(`Job ${jsonData.display_name} still in ${status} ...  reseting tries `);",
							"        console.log(`Job ${jsonData.display_name} still in ${status} ... reseting tries`); ",
							"        console.log(`Currently on trial number: ${pm.collectionVariables.get('tries')} out of ${maxNumberOfTries} ... waiting 10 minutes `); ",
							"        pm.collectionVariables.set(\"tries\", 1);",
							"        setTimeout(function() {}, 60000*10); // sleep TEN minute's and search for job ID. CSO will time out the JOB eventually",
							"        nextRequest = 'CSO-job_status';",
							"        //postman.setNextRequest(pm.info.requestId); // simple way of repeating same as above",
							"    }",
							"    // If status is in progress or unknnown",
							"    if ((status === 'unknown' || status === 'in-progress' || results.length === 0) && (pm.collectionVariables.get(\"tries\") < maxNumberOfTries)) {",
							"        pm.test.skip(`Job ${jsonData.display_name} still in ${status} ...  waiting another ${sleepBetweenTries/60000} minutes `);",
							"        console.log(`Job ${jsonData.display_name} still in ${status} ... `); ",
							"        console.log(`Currently on trial number: ${pm.collectionVariables.get('tries')} out of ${maxNumberOfTries} ... waiting another ${sleepBetweenTries/60000} minutes `); ",
							"        tries = parseInt(pm.collectionVariables.get(\"tries\"), 10);",
							"        pm.collectionVariables.set(\"tries\", tries + 1);",
							"        setTimeout(function() {}, sleepBetweenTries);",
							"        nextRequest = 'CSO-job_status';",
							"        //postman.setNextRequest(pm.info.requestId); // simple way of repeating same as above",
							"    } ",
							"    else {",
							"",
							"        // ",
							"        //.   SUCCESS",
							"        //",
							"",
							"        pm.collectionVariables.unset(\"tries\");   ",
							"        job_name = jsonData.display_name.replace(/_[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{9,109}$/g, \" \");",
							"        // DEBUG",
							"        //console.log(`Processing job with name(corrected): ${job_name} ....`);",
							"        //console.log(`Processing job with name(plain): ${jsonData.display_name} ....`);",
							"        if (status === 'success') {",
							"            // Check if first step druing provisioning ' Configure Spoke site' has started and if so, get time.",
							"            if (jsonData.display_name.includes('Configure Spoke Site ' + site_name)) {",
							"                //pm.collectionVariables.set(site_name + '-configure',true);",
							"                pm.collectionVariables.set('job_search_start_time', jsonData.end_time);",
							"                pm.collectionVariables.set('job_search_regex','Bootstrap Device ' + site_name);",
							"                console.log(' - Succed Configure ... next Bootstrap');",
							"                //In case job finished more than 5 minutes ago, no need to wait unlike real-time deployemtn",
							"                if (five_min_ago < jsonData.end_time) {",
							"                    setTimeout(function() {}, 60000); // sleep one minute and search for Service provision job ID",
							"                }",
							"                nextRequest = 'CSO-get_jobs';",
							"            }",
							"            if (jsonData.display_name.includes('Bootstrap Device ' + site_name)) {",
							"                pm.collectionVariables.set('job_search_start_time', jsonData.end_time-30);",
							"                pm.collectionVariables.set('job_search_regex','Zero Touch Provisioning ' + site_name);",
							"                console.log(' - Succed Bootstrap ... next Zero Touch');",
							"                //In case job finished more than 5 minutes ago, no need to wait unlike real-time deployemtn",
							"                if (five_min_ago < jsonData.end_time) {",
							"                    setTimeout(function() {}, 60000); // sleep one minute and search for Service provision job ID",
							"                }",
							"                nextRequest = 'CSO-get_jobs';",
							"            }",
							"            if (jsonData.display_name.includes('Zero Touch Provisioning ' + site_name)) {",
							"                pm.collectionVariables.set('job_search_start_time', jsonData.end_time-30);",
							"                pm.collectionVariables.set('job_search_regex','Service Provisioning ' + site_name);",
							"                console.log(' - Succed Zero Touch ... next Service Provisioning');",
							"",
							"                //In case job finished more than 5 minutes ago, no need to wait unlike real-time deployemtn",
							"                if (five_min_ago < jsonData.end_time) {",
							"                    setTimeout(function() {}, 60000); // sleep one minute and search for Service provision job ID",
							"                }",
							"                nextRequest = 'CSO-get_jobs';",
							"            }",
							"            ",
							"            if (jsonData.display_name.includes('Service Provisioning ' + site_name)) {",
							"                pm.collectionVariables.set('job_search_start_time', jsonData.end_time-30);",
							"                pm.collectionVariables.set('service_provisioning_end_time', jsonData.end_time-30);",
							"                pm.collectionVariables.set('job_search_regex','.*AUTO+.*');",
							"                console.log(' - Succed Service Provisioning ... next looking for AUTO jobs');",
							"                //In case job finished more than 5 minutes ago, no need to wait unlike real-time deployemtn",
							"                if (five_min_ago < jsonData.end_time) {",
							"                    setTimeout(function() {}, 120000); // sleep two minutes and search for Service provision job ID",
							"                }",
							"                nextRequest = 'CSO-get_jobs';",
							"            }",
							"            if (jsonData.display_name.includes('AUTONAT')) {",
							"                console.log('AUTONAT sucessfull ...');",
							"                pm.collectionVariables.set('AUTO_NAT', true);",
							"                nextRequest = 'CSO-job_status';",
							"            }",
							"            if (jsonData.display_name.includes('AUTO') && jobs.lenght > 0) {",
							"                nextRequest = 'CSO-job_status';",
							"            }",
							"            if (jsonData.display_name.includes('DHCP Update for WAN_0 of ' + site_name)) {",
							"                console.log('DHCP_WAN_0 sucessfull ...');",
							"                pm.collectionVariables.set('DHCP_WAN_0', true);",
							"                nextRequest = 'CSO-job_status';",
							"            }",
							"            if (jsonData.display_name.includes('DHCP Update for WAN_1 of ' + site_name)) {",
							"                console.log('DHCP_WAN_1 sucessfull ...');",
							"                pm.collectionVariables.set('DHCP_WAN_1', true);",
							"                nextRequest = 'CSO-job_status';",
							"            }",
							"        }",
							"",
							"        //",
							"        // Repeat of service provisioning in case of single failure",
							"        //",
							"        if (status === 'failed' && jsonData.display_name.includes('Configure Spoke Site ' + site_name)) {",
							"            if (!pm.collectionVariables.get(\"tries\")) { ",
							"                pm.collectionVariables.set(\"tries\", 1); ",
							"            }",
							"            else {",
							"                tries = parseInt(pm.collectionVariables.get(\"tries\"), 10);",
							"                pm.collectionVariables.set(\"tries\", tries + 1);",
							"                if (pm.collectionVariables.get(\"tries\") < 2) {",
							"                    console.log(' - Failed Service Provisioning ... trying again');",
							"                    setTimeout(function() {}, 60000); // sleep one minute and search for Service provision job ID",
							"                    nextRequest = 'CSO-job_retry';",
							"                }",
							"                else {",
							"                    console.log(' - Reapeded Failure Service Provisioning ... aborting ');",
							"                    pm.collectionVariables.unset(\"tries\");",
							"                    nextRequest = null;",
							"                }",
							"            }",
							"        }",
							"        ",
							"        // ",
							"        //.   DRILL DOWN  IN TO INDIVIDUAL SUB-TASKs",
							"        //",
							"",
							"        if (Array.isArray(jsonData.summary.task_tree.children)) {",
							"            task_count = jsonData.summary.task_count;",
							"            fail_count = jsonData.summary.fail_count;",
							"            date = moment.unix(jsonData.end_time).format('llll');",
							"            //console.log(`${jsonData.display_name.substring(0,15)} job has: ${status}, Job ID: ${uuid} `);",
							"            console.log(`${job_name} job has: ${status}, Job ID: ${uuid} `);",
							"            if (fail_count != 0){",
							"                console.log(`- It had ${task_count} child-jobs from which ${fail_count - 1} had failed. Job End time: ${end_time}`);",
							"            }",
							"            else {",
							"                console.log(`- It had ${task_count} child-jobs and none has failed. Job End time: ${date}`);",
							"            }",
							"            ",
							"            jsonData.summary.task_tree.children.forEach(function (child) {",
							"                child_name = child.path.replace(`${uuid}/`, '');",
							"                readable_name = child_name.replace(/\\//g, \" - \");",
							"                //console.log(`${readable_name} .... ${child.task_status} `);",
							"                if (child.task_status === 'in-progress') {",
							"                    pm.test.skip(`--- ${readable_name} still in progress ... `);",
							"                }",
							"                else  {",
							"                    if (child.task_status === 'failed') { console.log(`--- ${readable_name} ... has failed `); }",
							"                    // Child Job Test",
							"                    pm.test(`--- ${readable_name} ... has ${child.task_status}`, function () {",
							"                        pm.expect(child.task_status).to.equal(\"success\");",
							"                    });",
							"                }",
							"",
							"                if (Array.isArray(child.children)) {",
							"                    child.children.forEach(function (sub_child) {",
							"                        // Removing job ID from the string",
							"                        sub_child_name = sub_child.path.replace(`${uuid}/`, '');",
							"                        readable_name = sub_child_name.replace(/\\//g, \" - \");",
							"                        sub_child_name = sub_child_name.replace(`${child_name}/`,'');",
							"                        if (sub_child.task_status === 'in-progress') {",
							"                            pm.test.skip('Job still in progress ... ');",
							"                        }",
							"                        else  {",
							"                            // We are here interested only in specific site not all sites",
							"                            if (job_name.includes('AUTO_SDWAN_policy')) { site = new RegExp(\".*\" + site_name+\"$\"); }",
							"                            else if (job_name.includes('AUTO_FW_policy')) { site = new RegExp(site_name+\"$\"); }",
							"                            else { site = new RegExp(site_name); }",
							"                            ",
							"                            if (sub_child_name.replace(/_.*/g,'').match(site) && sub_child.task_status == 'success') {",
							"                                if (sub_child.task_status === 'failed') { console.log(`------> FAILED Sub-child job: ${sub_child_name.replace(/_.*/g,'')}`); }",
							"                                // Child Job Test",
							"                                //------> Sub-Task: SDWAN policy deployment on device PBSC-Site-1 ... was success",
							"                                pm.test(`------> Sub-Task: ${sub_child_name.replace(/_.*/g,'')} ... was success`, function () {",
							"                                    pm.expect(sub_child.task_status).to.equal(\"success\");",
							"                                });",
							"                                if (job_name.includes('AUTO_FW_policy')) {",
							"                                    pm.collectionVariables.set('AUTO_FW', true);",
							"                                    console.log('AUTO_FW_policy sucessfull ...');",
							"                                }",
							"                                if (job_name.includes('AUTO_SDWAN_policy')) {",
							"                                    pm.collectionVariables.set('AUTO_SDWAN', true);",
							"                                    console.log('AUTO_SDWAN_policy sucessfull ...');",
							"                                }                        ",
							"                            }",
							"                        }",
							"                    })",
							"                } //End of sub_child loop",
							"            })",
							"        } // End of job children loop",
							"",
							"        // Main Policy Test     ",
							"        if (( job_name.includes('AUTO_FW_policy') && pm.collectionVariables.get('AUTO_FW') == true) || (job_name.includes('AUTO_SDWAN_policy') && pm.collectionVariables.get('AUTO_SDWAN') == true )) { status = \"success\"; }",
							"        pm.test(`${job_name} ... was ${status}`, function () {",
							"        //pm.test(`${jsonData.display_name} ... was success`, function () {",
							"            pm.expect(status).to.equal(\"success\");",
							"        });",
							"",
							"    }",
							"} //End of condition checking if site has been already provisioned",
							"",
							"// In Case nay of AUTO JOb's fail ",
							"if ( (jobs && JSON.parse(jobs).length === 0) && (pm.collectionVariables.get('AUTO_NAT') != true || pm.collectionVariables.get('AUTO_FW') != true || pm.collectionVariables.get('AUTO_SDWAN') != true || pm.collectionVariables.get('DHCP_WAN_0') != true || pm.collectionVariables.get('DHCP_WAN_1') != true) && nextRequest === null ) {",
							"    console.log('Site NOT sucessfully provisioned .... please review');",
							"    pm.test(` Site ${site_name} was NOT sucessfully provisioned ....`, function () {",
							"        pm.expect(complete).to.equal(true);",
							"    });      ",
							"}",
							"else { // IF. AUTO just finished sucessfully, start looking for DHCP for WAN_0 and WAN_1",
							"    if (pm.collectionVariables.get('AUTO_NAT') == true && pm.collectionVariables.get('AUTO_FW') == true && pm.collectionVariables.get('AUTO_SDWAN') == true && auto_complete != true && (pm.collectionVariables.get('DHCP_WAN_0') != true || pm.collectionVariables.get('DHCP_WAN_1') != true)) {",
							"        pm.collectionVariables.set('job_search_start_time', pm.collectionVariables.get('service_provisioning_end_time'));",
							"        pm.collectionVariables.set('job_search_regex','.*DHCP Update for WAN.[0,1] of ' + site_name);",
							"        console.log('Site AUTO_NAT,AUTO_FW and AUTO_SDWAN sucessfully provisioned .... next checking DHCP Update');",
							"        //In case job finished more than 5 minutes ago, no need to wait unlike real-time deployemtn",
							"        if (five_min_ago < jsonData.end_time) {",
							"            setTimeout(function() {}, 120000); // sleep two minutes and search for Service provision job ID",
							"        }",
							"        nextRequest = 'CSO-get_jobs';",
							"    }",
							"    if ((pm.collectionVariables.get('DHCP_WAN_0') == true || pm.collectionVariables.get('DHCP_WAN_1') == true) && pm.collectionVariables.get('AUTO_NAT') == true && pm.collectionVariables.get('AUTO_FW') == true && pm.collectionVariables.get('AUTO_SDWAN') == true) {",
							"        console.log(\"SECOND IF LOOP ....\")",
							"        if ((jobs && JSON.parse(jobs).length === 0) && pm.collectionVariables.get('DHCP_WAN_0') == true && pm.collectionVariables.get('DHCP_WAN_1') != true ){",
							"            var complete = true;",
							"            console.log('Site provisioned without WAN_1 .... next checking MIST org');",
							"            pm.test(` Site ${site_name} was provisioned without WAN_1 ....`, function () {",
							"                pm.expect(complete).to.equal(true);",
							"            });      ",
							"            nextRequest = 'MIST-org_sites';",
							"",
							"        }",
							"        if ((jobs && JSON.parse(jobs).length === 0) && pm.collectionVariables.get('DHCP_WAN_0') != true && pm.collectionVariables.get('DHCP_WAN_1') == true ){",
							"            var complete = true;",
							"            console.log('Site provisioned without WAN_0 .... next checking MIST org');",
							"            pm.test(` Site ${site_name} was provisioned without WAN_0 ....`, function () {",
							"                pm.expect(complete).to.equal(true);",
							"            });      ",
							"            nextRequest = 'MIST-org_sites';",
							"",
							"        }",
							"",
							"        if (pm.collectionVariables.get('DHCP_WAN_0') == true && pm.collectionVariables.get('DHCP_WAN_1') == true){ ",
							"            var complete = true;",
							"            console.log('Site sucessfully provisioned .... next checking MIST org');",
							"            pm.test(` Site ${site_name} was sucessfully provisioned ....`, function () {",
							"                pm.expect(complete).to.equal(true);",
							"            });      ",
							"            nextRequest = 'MIST-org_sites';",
							"        }",
							"    }",
							"}",
							"",
							"console.log(`setting next request ... ${nextRequest}`);",
							"postman.setNextRequest(nextRequest);"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"console.log('-------------------- JOB STATUS --------------------------------------');",
							"var jobs = pm.collectionVariables.get(\"jobs\");",
							"var tries = pm.collectionVariables.get(\"tries\");",
							"var env_job_id = pm.environment.get('job_id');",
							"console.log('Enviroment job:', env_job_id);",
							"// IF the list job is defined and is not empty, take a first value and assign it to variable job_id",
							"// List job gets populated in get_jobs function that searches for all jobs in given time frame.",
							"",
							"//filter trough jobs only if they are not in progress. IE, if only one AUTO finished and we are waiting for the few others, tries will be defined",
							"//if(jobs && jobs.length > 0) {",
							"//if(jobs && jobs.length > 2 && !tries) {",
							"if(jobs && JSON.parse(jobs).length > 0 && !tries) {",
							"    jobs =JSON.parse(jobs);",
							"    var currentjob = jobs.shift();",
							"    console.log('currentjob:',currentjob);",
							"    console.log('jobs:',jobs);",
							"    // Unsetting Enviroment variable in case it is define as it beats collection variable",
							"    if (env_job_id == true || (env_job_id && env_job_id.length > 0)) {",
							"        //postman.clearEnvironmentVariable('job_id');",
							"        pm.environment.unset('job_id');",
							"        //pm.environment.set('job_id','');",
							"        console.log('Detected Enviroment variable job_id also used in collectionVariables, unseting env ...')",
							"    }",
							"",
							"    if (typeof currentjob !== 'undefined') {pm.collectionVariables.set(\"job_id\", currentjob); }",
							"    pm.collectionVariables.set(\"jobs\", JSON.stringify(jobs));",
							"}",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "apikey",
					"apikey": [
						{
							"key": "value",
							"value": "{{token}}",
							"type": "string"
						},
						{
							"key": "key",
							"value": "x-auth-token",
							"type": "string"
						},
						{
							"key": "in",
							"value": "header",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/job-service/job/:job_id",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"job-service",
						"job",
						":job_id"
					],
					"variable": [
						{
							"key": "job_id",
							"value": "{{job_id}}"
						}
					]
				}
			},
			"response": [
				{
					"name": "CSO-job_status",
					"originalRequest": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/job-service/job/:job_id",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"job-service",
								"job",
								":job_id"
							],
							"variable": [
								{
									"key": "job_id",
									"value": "{{job_id}}"
								}
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Date",
							"value": "Fri, 19 Nov 2021 22:07:40 GMT"
						},
						{
							"key": "Content-Type",
							"value": "application/json"
						},
						{
							"key": "Content-Length",
							"value": "24591"
						},
						{
							"key": "Connection",
							"value": "keep-alive"
						},
						{
							"key": "Set-Cookie",
							"value": "AWSALB=7++suAxe29rwb3e1A0uSvtmi4Dfj/6J2aPsdN8y+0u5bu39b4YdO3GFRV8mxiRY+1q6Y/yxrmHadNH6SAOFJbpGt1P2+ZxWA4OwgXrF4xrMwBX9wHrg9MAcRWSKj; Expires=Fri, 26 Nov 2021 22:07:40 GMT; Path=/"
						},
						{
							"key": "Set-Cookie",
							"value": "AWSALBCORS=7++suAxe29rwb3e1A0uSvtmi4Dfj/6J2aPsdN8y+0u5bu39b4YdO3GFRV8mxiRY+1q6Y/yxrmHadNH6SAOFJbpGt1P2+ZxWA4OwgXrF4xrMwBX9wHrg9MAcRWSKj; Expires=Fri, 26 Nov 2021 22:07:40 GMT; Path=/; SameSite=None; Secure"
						},
						{
							"key": "Server",
							"value": "nginx/1.15.10"
						},
						{
							"key": "Etag",
							"value": "\"2021-11-19T22:07:29.439989\""
						},
						{
							"key": "X-Request-Id",
							"value": "9986c4aa3c5c0f01ae70f421906dfa23,lgYU"
						},
						{
							"key": "Strict-Transport-Security",
							"value": "max-age=15724800"
						}
					],
					"cookie": [],
					"body": "{\n    \"job\": {\n        \"status\": \"failed\",\n        \"parent_uuid\": \"d60f49d4-3104-4a6a-a3f7-bde2ee392ba6\",\n        \"parent_type\": \"project\",\n        \"start_time\": 1637359304,\n        \"job_type\": \"csp.policy-mgmt.policy-deployments.deploy.FW\",\n        \"hidden_flag\": false,\n        \"perms2\": {\n            \"owner\": \"d60f49d431044a6aa3f7bde2ee392ba6\",\n            \"owner_access\": 7,\n            \"global_access\": 0,\n            \"share\": [\n                {\n                    \"tenant_access\": 7,\n                    \"tenant\": \"c22a09669f334aec983ddf4853aa05e6\"\n                }\n            ]\n        },\n        \"task_count\": 154,\n        \"display_name\": \"AUTO_FW_policy_48e3d556-4984-11ec-8675-7af90cc45604\",\n        \"name\": \"AUTO_FW_policy_48e3d556-4984-11ec-8675-7af90cc45604\",\n        \"category\": \"simple\",\n        \"fq_name\": [\n            \"default-domain\",\n            \"OpenLab\",\n            \"AUTO_FW_policy_48e3d556-4984-11ec-8675-7af90cc45604\"\n        ],\n        \"uuid\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3\",\n        \"monitor_flag\": true,\n        \"uri\": \"/job-service/job/1f80253d-45cf-44bf-89fa-c81ef18657d3\",\n        \"convert_timeout\": 0,\n        \"summary\": {\n            \"fail_count\": 88,\n            \"success_count\": 67,\n            \"task_count\": 154,\n            \"task_tree\": {\n                \"child_task_status\": {\n                    \"failed\": 1,\n                    \"success\": 3\n                },\n                \"task_status\": \"failed\",\n                \"children\": [\n                    {\n                        \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Resolving Endpoints\",\n                        \"child_task_status\": {},\n                        \"task_status\": \"success\",\n                        \"children\": []\n                    },\n                    {\n                        \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Policy Diff Task\",\n                        \"child_task_status\": {},\n                        \"task_status\": \"success\",\n                        \"children\": []\n                    },\n                    {\n                        \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task\",\n                        \"child_task_status\": {\n                            \"failed\": 87,\n                            \"success\": 64\n                        },\n                        \"task_status\": \"failed\",\n                        \"children\": [\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-102_1\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-60_2\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-39_3\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-54_4\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-49_5\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P1-E-HUB-3-SRX4200_6\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-21_7\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-95_8\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-8_9\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-14_10\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-19_11\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PC-vSRX-001_12\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-71_13\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-36_14\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-109_15\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P1-E-HUB-1-SRX4200_16\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-68_17\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-26_18\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-38_19\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-19_20\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-17_21\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-50_22\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-12_23\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-34_24\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-69_25\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-73_26\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-21_27\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-78_28\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-92_29\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-10_30\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-55_31\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-35_32\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-29_33\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-106_34\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-5_35\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-7_36\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/STE-113-SRX320_37\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/S25428_38\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-11_39\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-87_40\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-13_41\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-14_42\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-11_43\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-13_44\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-48_45\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-72_46\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-52_47\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-89_48\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-25_49\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-40_50\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-28_51\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/site33_52\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-77_53\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-9_54\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-63_55\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-57_56\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-9_57\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-103_58\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-91_59\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-64_60\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-33_61\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PB-Site15_62\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/site3LTE_63\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-70_64\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-12_65\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-3_66\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-4_67\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-98_68\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/STE-116-SRX320_69\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-66_70\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-23_71\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-47_72\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/STE-115-SRX320_73\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-4_74\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/S25432_75\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/STE-114-SRX320_76\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-62_77\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-22_78\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-82_79\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-20_80\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-10_81\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-88_82\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-6_83\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-3_84\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/site0_85\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P1-E-HUB-4-SRX4200_86\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-41_87\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-101_88\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-2_89\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-27_90\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PB-Site-11_91\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P1-E-HUB-2-SRX4200_92\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-81_93\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-32_94\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-83_95\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-105_96\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-61_97\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-53_98\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-15_99\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-110_100\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-22_101\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-15_102\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-44_103\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-107_104\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/S25426_105\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-56_106\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PB-Site-9_107\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-6_108\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-16_109\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-43_110\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/site333PPPoA_111\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-51_112\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-2_113\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-108_114\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-7_115\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-67_116\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-1_117\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-46_118\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-80_119\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-76_120\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-30_121\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-31_122\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-1_123\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-94_124\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-90_125\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PB-Site16_126\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-59_127\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-85_128\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-104_129\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-84_130\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/STE-112-SRX320_131\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-8_132\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-86_133\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-74_134\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-24_135\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PB-Site17_136\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/S25433_137\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P6-SITE-97_138\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-42_139\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-58_140\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-17_141\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-5_142\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-20_143\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P3-SITE-37_144\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P2-SITE-18_145\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-79_146\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-75_147\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/STE-111-SRX320_148\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/PBSC-Site-18_149\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"success\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P4-SITE-45_150\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            },\n                            {\n                                \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Task/D1P5-SITE-65_151\",\n                                \"child_task_status\": {},\n                                \"task_status\": \"failed\",\n                                \"children\": []\n                            }\n                        ]\n                    },\n                    {\n                        \"path\": \"1f80253d-45cf-44bf-89fa-c81ef18657d3/Deployment Completion\",\n                        \"child_task_status\": {},\n                        \"task_status\": \"success\",\n                        \"children\": []\n                    }\n                ]\n            }\n        },\n        \"id_perms\": {\n            \"enable\": true,\n            \"uuid\": {\n                \"uuid_mslong\": 2269855157289174207,\n                \"uuid_lslong\": 9942479162600478675\n            },\n            \"created\": \"2021-11-19T22:01:44.959197\",\n            \"description\": null,\n            \"creator\": \"admin\",\n            \"user_visible\": true,\n            \"last_modified\": \"2021-11-19T22:07:29.439989\",\n            \"modifier\": \"admin\",\n            \"permissions\": {\n                \"owner\": \"admin\",\n                \"owner_access\": 7,\n                \"other_access\": 7,\n                \"group\": \"admin\",\n                \"group_access\": 7\n            }\n        },\n        \"end_time\": 1637359649,\n        \"request_id\": \"deploy_3e5fcb76-4984-11ec-844a-a697ec056069\",\n        \"percentage\": 100,\n        \"parent_uri\": \"/job-service/project/d60f49d4-3104-4a6a-a3f7-bde2ee392ba6\",\n        \"job_timeout\": 120\n    }\n}"
				}
			]
		},
		{
			"name": "CSO-job_retry",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"console.log('-------------------- JOB RETRY --------------------------------------');",
							"console.log(`Retry of job ${job_id} name: ${job_search_regex}`);",
							"var jsonData = JSON.parse(responseBody);",
							"nextRequest = null;",
							"",
							"pm.test(\"Status code is 200\", function() {",
							"  pm.expect(pm.response.code).to.equal(200);",
							"});",
							"if (pm.response.code == 200 && jsonData.output.result === 'success') {",
							"    pm.collectionVariables.set(\"job_id\", jsonData.output.job_id)",
							"    console.log(`job: ${pm.collectionVariables.get('job_id')}`);",
							"    console.log(`Result of retry: ${jsonData.output.result}`);",
							"    nextRequest = 'CSO-job_status'",
							"}",
							"console.log(`setting next request ... ${nextRequest}`);",
							"postman.setNextRequest(nextRequest);",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "apikey",
					"apikey": [
						{
							"key": "value",
							"value": "{{token}}",
							"type": "string"
						},
						{
							"key": "key",
							"value": "x-auth-token",
							"type": "string"
						},
						{
							"key": "in",
							"value": "header",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [
					{
						"key": "x-auth-token",
						"type": "text",
						"value": "{{token}}",
						"disabled": true
					},
					{
						"key": "Content-Type",
						"type": "text",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"input\": {\r\n        \"job_uuid\": \"{{job_id}}\"\r\n    }\r\n}"
				},
				"url": {
					"raw": "{{base_url}}/job-service/retry-job",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"job-service",
						"retry-job"
					]
				}
			},
			"response": []
		},
		{
			"name": "CSO-get_jobs",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"nextRequest = null;",
							"var jobs = [];",
							"//console.log(`Lenght of total value: ${jsonData.total.length}`);",
							"",
							"if (pm.response.code == 200 && jsonData.total >= 1) {",
							"",
							"    // Diving to individual job by findingout number of jobs(jobitems) ",
							"    var jobitems = jsonData.total",
							"    // Debug to view inside of loop in case of troubleshooting",
							"    //console.log(`Lenght of job array ${jobitems}`);",
							"",
							"    for (var i = 0; i < jobitems; i++) {",
							"        pm.collectionVariables.unset(\"tries\"); ",
							"        // assign given i job to item",
							"        var item = jsonData.job[i];",
							"        //assign variables from each job",
							"        status = item.status;",
							"        name = item.display_name.replace(/_/g,' ');",
							"        task_count = item.task_count;",
							"        if(item.summary) {",
							"            if (item.summary.fail_count && item.summary.fail_count.length > 0) { ",
							"                fail_count = item.summary.fail_count; ",
							"            }",
							"            else {",
							"            fail_count = 0;",
							"            }",
							"        } ",
							"        else {",
							"            fail_count = 0;",
							"        }",
							"        uuid = item.uuid;",
							"        // Parent Job Test",
							"        if (status === 'in-progress') {",
							"            pm.test.skip(`Job ${name}still in progress ... `);  ",
							"            jobs.push(item.uuid);",
							"            nextRequest = \"CSO-job_status\";",
							"        }    ",
							"        else {",
							"            jobs.push(item.uuid);",
							"            ",
							"            pm.test.skip(`Found job ${name} ...  `);         ",
							"            nextRequest = \"CSO-job_status\";",
							"        }",
							"        // Child_size is count of pass and failed children job",
							"        //child_size = item.summary.task_tree.child_task_status.failed + item.summary.task_tree.child_task_status.success;",
							"        console.log(`Found ${item.status} Job ${name} ...`);",
							"        //console.log(`Job ${name} has: ${item.status}`);",
							"        //console.log(`- Job ID: ${item.uuid}`);",
							"        //console.log(`- It had ${item.task_count} child-jobs from which ${fail_count - 1} had failed`);",
							"        ",
							"        //in case of service provisioning fails",
							"        if (name.toLowerCase().includes('service provisioning')){",
							"            pm.collectionVariables.set('job_id',item.uuid);",
							"            console.log(`job_id set to: ${pm.collectionVariables.get('job_id')}`);",
							"            if (typeof item['request_id'] != 'undefined') {",
							"                pm.collectionVariables.set('x_request_id',item['request_id']);",
							"                console.log(`Env x-reuest-id set to: ${pm.collectionVariables.get('x_request_id')}`);",
							"            }",
							"            if (typeof item.id_perms['created'] != 'undefined') {",
							"                pm.collectionVariables.set('request_id_date',item.id_perms.created.substring(0,10));",
							"                console.log(`Env request_id_date: ${pm.collectionVariables.get('request_id_date')}`);",
							"            }",
							"        }",
							"    }      ",
							"    console.log('Found job ID\\'s:\\n',jobs);",
							"    pm.collectionVariables.set('jobs',JSON.stringify(jobs));  ",
							"}",
							"   ",
							"",
							"// In case device has not been detected and Bootstrap did not started",
							"if (pm.response.code == 200 && jsonData.total == 0 && pm.collectionVariables.get('job_search_regex','Bootstrap Device ' + pm.environment.get('site_name'))) {",
							"    console.log(`Site ${pm.environment.get('site_name')} has not been detected ${tries}x wating 3 minutes and trying again ...`);",
							"    setTimeout(function() {}, 60000*3); // sleep 3 minute's and search for job ID. CSO will time out the JOB eventually",
							"    var maxNumberOfTries = 10; // your max number of tries",
							"    if (!pm.collectionVariables.get(\"tries\")) { ",
							"        pm.collectionVariables.set(\"tries\", 1);",
							"        nextRequest = \"CSO-get_jobs\";",
							"    }",
							"    else {",
							"        tries = parseInt(pm.collectionVariables.get(\"tries\"), 10);",
							"        pm.collectionVariables.set(\"tries\", tries + 1);",
							"        if (pm.collectionVariables.get(\"tries\") < maxNumberOfTries) {",
							"            nextRequest = \"CSO-get_jobs\";",
							"        }",
							"        else {",
							"            console.log('Site was not detected in 30 minutes, try manmualy again later .... ')",
							"        }",
							"    }",
							"    pm.test.skip(`Bootstrap for ${pm.environment.get('site_name')} has not been detected wating 3 minutes and trying again ...`);",
							"}",
							"",
							"console.log(`setting next request ... ${nextRequest}`);",
							"postman.setNextRequest(nextRequest);",
							""
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"var moment = require('moment');",
							"var start_time = pm.collectionVariables.get('job_search_start_time');",
							"pm.collectionVariables.set('now_time', moment().unix());",
							"",
							"//console.log(\"Pre-request start------------------------\");",
							"console.log('-------------------- GET JOBs --------------------------------------');",
							"console.log(` Query Start time: ${moment.unix(start_time).format('dd MMMM Do YYYY, hh:mm:ss a')}`);",
							"console.log(` Queary End time (LTE): ${moment()}`);",
							"//pm.collectionVariables.unset('jobs');",
							"pm.collectionVariables.set('job_id','');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "apikey",
					"apikey": [
						{
							"key": "value",
							"value": "{{token}}",
							"type": "string"
						},
						{
							"key": "key",
							"value": "x-auth-token",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"query\": {\n        \"bool\": {\n            \"must\": [{\n                \"range\": {\n                    \"start_time\": {\n                        \"gte\": \"{{job_search_start_time}}\"\n                    }\n                }\n            }, {\n                \"range\": {\n                    \"start_time\": {\n                        \"lte\": \"{{now_time}}\"\n                    }\n                }\n            }, {\n                \"regexp\": {\n                    \"display_name._raw\": \"{{job_search_regex}}\"\n                }\n            }],\n            \"should\": [],\n            \"must_not\": [{\n                \"term\": {\n                    \"hidden_flag\": true\n                }\n            }]\n        }\n    },\n    \"from\": 0,\n    \"size\": 100,\n    \"sort\": [{\n        \"start_time._raw\": {\n            \"order\": \"asc\"\n        }\n    }],\n    \"detail\": true\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/job-service/job/_filter",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"job-service",
						"job",
						"_filter"
					]
				},
				"description": "This will return jobs of lost hour (unless changed) of given tenant (depended on environment).\n\nIf it contains failed 'Service provisioning' job, it will store *job-id*, *x_request_id* and date of job (*request_id_date*) as variable to be used for device_errors or \"Errors from device-step-2\""
			},
			"response": []
		},
		{
			"name": "MIST-org_sites",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"var site_name = pm.environment.get('site_name');",
							"var org_id = pm.environment.get('org_id');",
							"var exist_in_mist = false;",
							"console.log('-------------------- MIST ORG SITES --------------------------------------');",
							"nextRequest = null;",
							"//console.log('jsonData length', jsonData.length);",
							"if (pm.response.code == 200 && jsonData.length >= 1) {",
							"    if (Array.isArray(jsonData)) {",
							"        jsonData.forEach(function(item) {",
							"            //console.log(`Site name ${item.name} with org_id: ${item.org_id}`);",
							"            if (item.name == site_name && item.org_id == org_id) {",
							"                pm.environment.set('site_id', item.id);",
							"                exist_in_mist = true;",
							"                console.log('Found site with matching Device name in MIST.... ');",
							"                nextRequest = \"CSO-get_all_devices\"",
							"                pm.test(`Found site with matching device name ${item.name} in MIST.... `, function() {",
							"                    pm.expect(item.name == site_name && item.org_id == org_id);",
							"                });               ",
							"            }",
							"        })",
							"    }",
							"}",
							"if (exist_in_mist == false) {",
							"    console.log('Site does not in MIST, need to create one ...');",
							"    nextRequest = 'MIST-create_site' // Next hop to create site ",
							"    pm.test(\"Site does not in MIST, need to create one ...\", function() {",
							"        pm.expect(pm.response.code).to.equal(200);",
							"    });    ",
							"    //setTimeout(function() {}, 60000*2);",
							"}",
							"console.log(`setting next request ... ${nextRequest}`);",
							"postman.setNextRequest(nextRequest);"
						],
						"type": "text/javascript"
					}
				}
			],
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"auth": {
					"type": "apikey",
					"apikey": [
						{
							"key": "value",
							"value": "Token {{mist_apitoken}}",
							"type": "string"
						},
						{
							"key": "key",
							"value": "Authorization",
							"type": "string"
						},
						{
							"key": "in",
							"value": "header",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "X-CSRFToken",
						"value": "{{csrftoken}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"op\": \"assign\",\n    \"site_id\": \"{{site_id}}\",\n    \"macs\": [\n        \"{{device_mac}}\"\n    ],\n    \"no_reassign\": false\n}\n",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "https://{{host}}/api/v1/orgs/{{org_id}}/sites",
					"protocol": "https",
					"host": [
						"{{host}}"
					],
					"path": [
						"api",
						"v1",
						"orgs",
						"{{org_id}}",
						"sites"
					]
				},
				"description": "#### Body Parameters\n**Parameter**|**Type**|**Description** \n:-------------: |:-------------: |:-------------: \nop|string|Required. unassign\nmacs|list|list of MAC, e.g. 5c5b350e0001"
			},
			"response": [
				{
					"name": "MIST-org_sites",
					"originalRequest": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "X-CSRFToken",
								"value": "{{csrftoken}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"op\": \"assign\",\n    \"site_id\": \"{{site_id}}\",\n    \"macs\": [\n        \"{{device_mac}}\"\n    ],\n    \"no_reassign\": false\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "https://{{host}}/api/v1/orgs/{{org_id}}/sites",
							"protocol": "https",
							"host": [
								"{{host}}"
							],
							"path": [
								"api",
								"v1",
								"orgs",
								"{{org_id}}",
								"sites"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Date",
							"value": "Thu, 24 Feb 2022 21:41:05 GMT"
						},
						{
							"key": "Content-Type",
							"value": "application/json"
						},
						{
							"key": "Content-Length",
							"value": "6190"
						},
						{
							"key": "Connection",
							"value": "keep-alive"
						},
						{
							"key": "Vary",
							"value": "Accept, Cookie"
						},
						{
							"key": "Allow",
							"value": "POST, OPTIONS, GET"
						},
						{
							"key": "X-Frame-Options",
							"value": "DENY"
						},
						{
							"key": "Cache-Control",
							"value": "no-cache, no-store"
						},
						{
							"key": "Pragma",
							"value": "no-cache"
						},
						{
							"key": "vary",
							"value": "Origin"
						},
						{
							"key": "Access-Control-Allow-Credentials",
							"value": "true"
						},
						{
							"key": "Access-Control-Expose-Headers",
							"value": "X-Auth-Token,X-CSRFToken,X-Page-Limit,X-Page-Page,X-Page-Total,X-Requested-With"
						},
						{
							"key": "Content-Security-Policy",
							"value": "default-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';"
						},
						{
							"key": "X-Content-Type-Options",
							"value": "nosniff"
						},
						{
							"key": "X-Xss-Protection",
							"value": "1; mode=block"
						},
						{
							"key": "Strict-Transport-Security",
							"value": "max-age=31536000; includeSubDomains; preload"
						},
						{
							"key": "Referrer-Policy",
							"value": "strict-origin-when-cross-origin"
						},
						{
							"key": "Permissions-Policy",
							"value": "geolocation=()"
						},
						{
							"key": "X-Kong-Upstream-Latency",
							"value": "18"
						},
						{
							"key": "X-Kong-Proxy-Latency",
							"value": "0"
						},
						{
							"key": "Via",
							"value": "kong/2.1.4"
						}
					],
					"cookie": [],
					"body": "[\n    {\n        \"country_code\": \"US\",\n        \"timezone\": \"America/New_York\",\n        \"address\": \"Miami, FL, USA\",\n        \"sitegroup_ids\": [\n            \"cb18054f-2bc2-4c7e-8e5d-8757c5911ad3\"\n        ],\n        \"notes\": \"\",\n        \"latlng\": {\n            \"lat\": 25.76168,\n            \"lng\": -80.19179\n        },\n        \"id\": \"6d7579cb-7686-4fbb-a32e-6ec7a96439dd\",\n        \"name\": \"Site-17\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"created_time\": 1631892686,\n        \"modified_time\": 1631892686,\n        \"rftemplate_id\": \"001edb80-3019-4776-a32c-1f031d81f27b\",\n        \"aptemplate_id\": null,\n        \"secpolicy_id\": null,\n        \"alarmtemplate_id\": null,\n        \"networktemplate_id\": null,\n        \"gatewaytemplate_id\": null,\n        \"tzoffset\": 1140\n    },\n    {\n        \"country_code\": \"AT\",\n        \"timezone\": \"Europe/Vienna\",\n        \"address\": \"Vienna, Austria\",\n        \"sitegroup_ids\": [\n            \"cb18054f-2bc2-4c7e-8e5d-8757c5911ad3\"\n        ],\n        \"notes\": \"Scale test for vSRX\",\n        \"latlng\": {\n            \"lat\": 48.208174,\n            \"lng\": 16.373819\n        },\n        \"id\": \"5fd93ae2-75c3-4911-968e-fd0e0cb5dd23\",\n        \"name\": \"Scale-vsrx\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"created_time\": 1633448385,\n        \"modified_time\": 1636671436,\n        \"rftemplate_id\": \"001edb80-3019-4776-a32c-1f031d81f27b\",\n        \"aptemplate_id\": null,\n        \"secpolicy_id\": null,\n        \"alarmtemplate_id\": null,\n        \"networktemplate_id\": null,\n        \"gatewaytemplate_id\": \"5c76e1c1-4c22-449f-9c7b-d09e9f9ab7ae\",\n        \"tzoffset\": 60\n    },\n    {\n        \"timezone\": \"America/Los_Angeles\",\n        \"country_code\": \"US\",\n        \"latlng\": {\n            \"lat\": 37.363863,\n            \"lng\": -121.901098\n        },\n        \"id\": \"84267544-bb31-4e91-8b1b-3f74281dba66\",\n        \"name\": \"PB-Site-17\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"created_time\": 1644963373,\n        \"modified_time\": 1644963373,\n        \"rftemplate_id\": null,\n        \"aptemplate_id\": null,\n        \"secpolicy_id\": null,\n        \"alarmtemplate_id\": null,\n        \"networktemplate_id\": null,\n        \"gatewaytemplate_id\": null,\n        \"tzoffset\": 960\n    },\n    {\n        \"country_code\": \"US\",\n        \"timezone\": \"America/Chicago\",\n        \"address\": \"Denver, CO, USA\",\n        \"sitegroup_ids\": [\n            \"cb18054f-2bc2-4c7e-8e5d-8757c5911ad3\"\n        ],\n        \"notes\": \"Switch at Mark's house\",\n        \"latlng\": {\n            \"lat\": 39.739236,\n            \"lng\": -104.990251\n        },\n        \"id\": \"6b186fb7-b84c-43d6-80cd-172190e39c8e\",\n        \"name\": \"Scherb-Home\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"created_time\": 1631719210,\n        \"modified_time\": 1633993067,\n        \"rftemplate_id\": \"001edb80-3019-4776-a32c-1f031d81f27b\",\n        \"aptemplate_id\": null,\n        \"secpolicy_id\": null,\n        \"alarmtemplate_id\": null,\n        \"networktemplate_id\": \"caa2396b-9eb8-4e85-89a9-4e461e63886b\",\n        \"gatewaytemplate_id\": null,\n        \"tzoffset\": 1080\n    },\n    {\n        \"country_code\": \"US\",\n        \"timezone\": \"America/Denver\",\n        \"address\": \"Colorado, USA\",\n        \"sitegroup_ids\": [\n            \"cb18054f-2bc2-4c7e-8e5d-8757c5911ad3\"\n        ],\n        \"notes\": \"\",\n        \"latlng\": {\n            \"lat\": 39.550051,\n            \"lng\": -105.782067\n        },\n        \"id\": \"8f98bc63-5390-4282-8c2e-69ec306258c6\",\n        \"name\": \"Site-9\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"created_time\": 1631560073,\n        \"modified_time\": 1631560073,\n        \"rftemplate_id\": \"001edb80-3019-4776-a32c-1f031d81f27b\",\n        \"aptemplate_id\": null,\n        \"secpolicy_id\": null,\n        \"alarmtemplate_id\": null,\n        \"networktemplate_id\": null,\n        \"gatewaytemplate_id\": null,\n        \"tzoffset\": 1020\n    },\n    {\n        \"country_code\": \"US\",\n        \"timezone\": \"America/Denver\",\n        \"address\": \"Denver, CO, USA\",\n        \"sitegroup_ids\": [\n            \"cb18054f-2bc2-4c7e-8e5d-8757c5911ad3\"\n        ],\n        \"notes\": \"\",\n        \"latlng\": {\n            \"lat\": 39.739236,\n            \"lng\": -104.990251\n        },\n        \"id\": \"ba9da8b8-8f12-4fbc-8c50-ea03b89efbc8\",\n        \"name\": \"Site-16\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"created_time\": 1631560157,\n        \"modified_time\": 1631560157,\n        \"rftemplate_id\": \"001edb80-3019-4776-a32c-1f031d81f27b\",\n        \"aptemplate_id\": null,\n        \"secpolicy_id\": null,\n        \"alarmtemplate_id\": null,\n        \"networktemplate_id\": null,\n        \"gatewaytemplate_id\": null,\n        \"tzoffset\": 1020\n    },\n    {\n        \"country_code\": \"US\",\n        \"timezone\": \"Pacific/Honolulu\",\n        \"address\": \"Honolulu, HI, USA\",\n        \"sitegroup_ids\": [\n            \"cb18054f-2bc2-4c7e-8e5d-8757c5911ad3\"\n        ],\n        \"notes\": \"CSO Managed PB-Site-15-Lab\",\n        \"latlng\": {\n            \"lat\": 21.306944,\n            \"lng\": -157.858333\n        },\n        \"id\": \"ac2ada26-7ca9-454e-aaaf-a0b331ca4bb4\",\n        \"name\": \"PB-site-15\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"created_time\": 1630500030,\n        \"modified_time\": 1630500076,\n        \"rftemplate_id\": \"001edb80-3019-4776-a32c-1f031d81f27b\",\n        \"aptemplate_id\": null,\n        \"secpolicy_id\": null,\n        \"alarmtemplate_id\": null,\n        \"networktemplate_id\": \"baa1ad5a-5df7-4df4-b31d-7cec6b18afac\",\n        \"gatewaytemplate_id\": null,\n        \"tzoffset\": 840\n    },\n    {\n        \"country_code\": \"US\",\n        \"timezone\": \"America/Anchorage\",\n        \"address\": \"Clear Creek Rd, Anderson, AK 99744, USA\",\n        \"sitegroup_ids\": [\n            \"cb18054f-2bc2-4c7e-8e5d-8757c5911ad3\"\n        ],\n        \"notes\": \"WAN2.0 test site\",\n        \"latlng\": {\n            \"lat\": 64.344381,\n            \"lng\": -149.177656\n        },\n        \"id\": \"6721194f-5c0c-42d8-9740-fd7aa0aef1f9\",\n        \"name\": \"WAN2.0\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"created_time\": 1636671911,\n        \"modified_time\": 1636736593,\n        \"rftemplate_id\": \"001edb80-3019-4776-a32c-1f031d81f27b\",\n        \"aptemplate_id\": null,\n        \"secpolicy_id\": null,\n        \"alarmtemplate_id\": null,\n        \"networktemplate_id\": null,\n        \"gatewaytemplate_id\": \"5c76e1c1-4c22-449f-9c7b-d09e9f9ab7ae\",\n        \"tzoffset\": 900\n    },\n    {\n        \"country_code\": \"US\",\n        \"timezone\": \"America/Chicago\",\n        \"address\": \"1901 W Harrison St, Chicago, IL 60612, USA\",\n        \"sitegroup_ids\": [\n            \"cb18054f-2bc2-4c7e-8e5d-8757c5911ad3\"\n        ],\n        \"notes\": \"CSO Managed PB-Site-11 LAN\",\n        \"latlng\": {\n            \"lat\": 41.873919,\n            \"lng\": -87.674338\n        },\n        \"id\": \"c48d8f39-67da-4767-8c2b-25c73a693ee0\",\n        \"name\": \"PB-site-11\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"created_time\": 1629981111,\n        \"modified_time\": 1637098983,\n        \"rftemplate_id\": \"001edb80-3019-4776-a32c-1f031d81f27b\",\n        \"aptemplate_id\": null,\n        \"secpolicy_id\": null,\n        \"alarmtemplate_id\": null,\n        \"networktemplate_id\": \"5f449e35-9d16-48fa-9389-abd75c8abf68\",\n        \"gatewaytemplate_id\": null,\n        \"tzoffset\": 1080\n    },\n    {\n        \"timezone\": \"Europe/London\",\n        \"country_code\": \"ES\",\n        \"latlng\": {\n            \"lat\": 51.507351,\n            \"lng\": -0.127758\n        },\n        \"address\": \"London, UK\",\n        \"notes\": \"CSO Managed  Jordi-site3LTE\",\n        \"sitegroup_ids\": [\n            \"7afd1a69-5093-4baf-9263-2b7ee7cf7a6d\"\n        ],\n        \"id\": \"05e22595-2b20-41f7-9620-daaca1ed084a\",\n        \"name\": \"site3LTE-jordi\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"created_time\": 1629971269,\n        \"modified_time\": 1641940078,\n        \"rftemplate_id\": \"001edb80-3019-4776-a32c-1f031d81f27b\",\n        \"aptemplate_id\": null,\n        \"secpolicy_id\": null,\n        \"alarmtemplate_id\": null,\n        \"networktemplate_id\": null,\n        \"gatewaytemplate_id\": null,\n        \"tzoffset\": 0\n    },\n    {\n        \"country_code\": \"ES\",\n        \"timezone\": \"Europe/Madrid\",\n        \"address\": \"Seville, Spain\",\n        \"sitegroup_ids\": [\n            \"cb18054f-2bc2-4c7e-8e5d-8757c5911ad3\"\n        ],\n        \"notes\": \"\",\n        \"latlng\": {\n            \"lat\": 37.389092,\n            \"lng\": -5.984459\n        },\n        \"id\": \"e31849f5-b2ec-4339-8eb9-e649f8521667\",\n        \"name\": \"PB-Abuse-vSRX\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"created_time\": 1645737156,\n        \"modified_time\": 1645737156,\n        \"rftemplate_id\": \"001edb80-3019-4776-a32c-1f031d81f27b\",\n        \"aptemplate_id\": null,\n        \"secpolicy_id\": null,\n        \"alarmtemplate_id\": null,\n        \"networktemplate_id\": null,\n        \"gatewaytemplate_id\": null,\n        \"tzoffset\": 60\n    }\n]"
				}
			]
		},
		{
			"name": "MIST-create_site",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"var nextRequest = null",
							"console.log('-------------------- MIST CREATE SITE --------------------------------------');",
							"if (pm.response.headers.get('Content-Type') == 'application/json') {",
							"    var jsonData = JSON.parse(responseBody);",
							"",
							"    //console.log('jsonData id length ... ',jsonData.id.length);",
							"    //console.log('jsonData name  ... ',jsonData.name);    ",
							"    //console.log('jsonData name indexof ... ',jsonData.name.indexOf(pm.environment.get('site_name')));        ",
							"    if ( jsonData.name.indexOf(pm.environment.get('site_name')) != -1 && jsonData.id.length > 0 && pm.response.code == 200 ) {",
							"        console.log(`Site ${pm.environment.get('site_name')} created successfuly in MIST with ID: ${jsonData.id} ...`);   ",
							"        pm.test(`Site ${pm.environment.get('site_name')} created successfuly in MIST with ID: ${jsonData.id} ...`, function() {",
							"          pm.expect(jsonData.name.indexOf(pm.environment.get('site_name'))) != -1;",
							"        });     ",
							"        pm.environment.set('site_id', jsonData.id);",
							"        nextRequest = 'CSO-get_all_devices';",
							"      }",
							"}",
							"console.log(`setting next request ... ${nextRequest}`);",
							"postman.setNextRequest(nextRequest);"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "apikey",
					"apikey": [
						{
							"key": "key",
							"value": "Authorization",
							"type": "string"
						},
						{
							"key": "value",
							"value": "Token {{mist_apitoken}}",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"name\": \"{{site_name}}\",\n    \"country_code\": \"ES\",\n    \"timezone\": \"Europe/Madrid\",\n    \"address\": \"Seville, Spain\",\n    \"notes\": \"Site created using API fomr CSO site loop POSTMAN runner ...\",\n    \"latlng\": {\n        \"lat\": 37.389092,\n        \"lng\": -5.984459\n    }\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "https://{{host}}/api/v1/orgs/:org_id/sites",
					"protocol": "https",
					"host": [
						"{{host}}"
					],
					"path": [
						"api",
						"v1",
						"orgs",
						":org_id",
						"sites"
					],
					"variable": [
						{
							"key": "org_id",
							"value": "{{org_id}}"
						}
					]
				}
			},
			"response": [
				{
					"name": "MIST-create_site",
					"originalRequest": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"{{site_name}}\",\n    \"country_code\": \"ES\",\n    \"timezone\": \"Europe/Madrid\",\n    \"address\": \"Seville, Spain\",\n    \"notes\": \"Site created using API fomr CSO site loop POSTMAN runner ...\",\n    \"latlng\": {\n        \"lat\": 37.389092,\n        \"lng\": -5.984459\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "https://{{host}}/api/v1/orgs/:org_id/sites",
							"protocol": "https",
							"host": [
								"{{host}}"
							],
							"path": [
								"api",
								"v1",
								"orgs",
								":org_id",
								"sites"
							],
							"variable": [
								{
									"key": "org_id",
									"value": "{{org_id}}"
								}
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Date",
							"value": "Thu, 24 Feb 2022 22:15:46 GMT"
						},
						{
							"key": "Content-Type",
							"value": "application/json"
						},
						{
							"key": "Content-Length",
							"value": "509"
						},
						{
							"key": "Connection",
							"value": "keep-alive"
						},
						{
							"key": "Vary",
							"value": "Accept, Cookie"
						},
						{
							"key": "Allow",
							"value": "OPTIONS, POST, GET"
						},
						{
							"key": "X-Frame-Options",
							"value": "DENY"
						},
						{
							"key": "Cache-Control",
							"value": "no-cache, no-store"
						},
						{
							"key": "Pragma",
							"value": "no-cache"
						},
						{
							"key": "vary",
							"value": "Origin"
						},
						{
							"key": "Access-Control-Allow-Credentials",
							"value": "true"
						},
						{
							"key": "Access-Control-Expose-Headers",
							"value": "X-Auth-Token,X-CSRFToken,X-Page-Limit,X-Page-Page,X-Page-Total,X-Requested-With"
						},
						{
							"key": "Content-Security-Policy",
							"value": "default-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';"
						},
						{
							"key": "X-Content-Type-Options",
							"value": "nosniff"
						},
						{
							"key": "X-Xss-Protection",
							"value": "1; mode=block"
						},
						{
							"key": "Strict-Transport-Security",
							"value": "max-age=31536000; includeSubDomains; preload"
						},
						{
							"key": "Referrer-Policy",
							"value": "strict-origin-when-cross-origin"
						},
						{
							"key": "Permissions-Policy",
							"value": "geolocation=()"
						},
						{
							"key": "X-Kong-Upstream-Latency",
							"value": "42"
						},
						{
							"key": "X-Kong-Proxy-Latency",
							"value": "0"
						},
						{
							"key": "Via",
							"value": "kong/2.1.4"
						}
					],
					"cookie": [],
					"body": "{\n    \"country_code\": \"ES\",\n    \"timezone\": \"Europe/Madrid\",\n    \"address\": \"Seville, Spain\",\n    \"notes\": \"Site created using API fomr CSO site loop POSTMAN runner ...\",\n    \"latlng\": {\n        \"lat\": 37.389092,\n        \"lng\": -5.984459\n    },\n    \"id\": \"e560fca6-847a-48a3-82f7-8ef4660facf1\",\n    \"name\": \"PB-Abuse-vSRX\",\n    \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n    \"created_time\": 1645740946,\n    \"modified_time\": 1645740946,\n    \"rftemplate_id\": null,\n    \"aptemplate_id\": null,\n    \"secpolicy_id\": null,\n    \"alarmtemplate_id\": null,\n    \"networktemplate_id\": null,\n    \"gatewaytemplate_id\": null,\n    \"tzoffset\": 60\n}"
				}
			]
		},
		{
			"name": "CSO-get_all_devices",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"//console.log (` Site: ${pm.environment.get('site_to_delete')} in Tenant: ${pm.environment.get('tenant_name')}`);",
							"site = new RegExp(\"^\"+pm.environment.get('site_name')+\"$\") ;",
							"nextRequest = null;",
							"",
							"if (pm.response.code == 200 || jsonData.total > 0) {",
							"    if (Array.isArray(jsonData.device)) {",
							"        jsonData.device.forEach(function(item) {",
							"            if (item.fq_name.includes(pm.environment.get('tenant_name')) && item.fq_name[2].match(site)) {",
							"                //pm.environment.set('device_map',device_list.set(item.fq_name[2],item.uuid));  // IF assigned to map",
							"                pm.collectionVariables.set('cso_site_uuid',item.uuid);",
							"                console.log('Got the SITE:',item.fq_name[2]);",
							"                pm.test(`Site ${pm.environment.get('site_name')} found UUID: ${item.uuid} ...`, function() {",
							"                    pm.expect(item.fq_name[2].match(site)) ;",
							"                });",
							"                nextRequest = 'CSO-get_device_info';",
							"                //device_list.set(item.fq_name[2]); // IF assigned to map",
							"                //device_list.push(item.uuid + ':JUNOS');",
							"            }",
							"        })",
							"    }",
							"}",
							"console.log(`CSO Site UUID: ${pm.collectionVariables.get('cso_site_uuid')}`);",
							"//pm.collectionVariables.set('devices',JSON.stringify(device_list));",
							"console.log(`setting next request ... ${nextRequest}`);",
							"postman.setNextRequest(nextRequest);"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"console.log('-------------------- GET ALL DEVICES --------------------------------------');",
							"pm.collectionVariables.set('cso_site_uuid','');",
							"sn = pm.collectionVariables.get('device_serial_number');",
							"mac = pm.collectionVariables.get('device_mac');",
							"if ( sn == true || (sn && sn.length > 0)) {",
							"    pm.collectionVariables.unset('device_serial_number');",
							"    //console.log('collectionVariables of device_serial_number: ', pm.collectionVariables.get('device_serial_number'));",
							"}",
							"if ( mac == true || (mac && mac.length > 0)) {",
							"    pm.collectionVariables.unset('device_mac');",
							"    //console.log(' Colleciton variable of device_mac: ', pm.collectionVariables.get('device_mac'));",
							"}",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "apikey",
					"apikey": [
						{
							"key": "value",
							"value": "{{token}}",
							"type": "string"
						},
						{
							"key": "key",
							"value": "x-auth-token",
							"type": "string"
						},
						{
							"key": "in",
							"value": "header",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [
					{
						"key": "x-auth-token",
						"type": "text",
						"value": "{{token}}",
						"disabled": true
					}
				],
				"url": {
					"raw": "{{base_url}}/ems-central/device",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"ems-central",
						"device"
					]
				},
				"description": "# GET retrieving list of ALL devices\n\nThis GET will retrieve list of all devices in given tenant, depending on **Enviroment** used.Store each one *device name* and *UUID* as local variable and also add UUID to a list.\nReason is that to get status -** UP or DOWN** requires UUID with string -JUNOS. Unfortunately names do not work.\n \n1. Look if local collection variable exist and is not empty. If so, it will get deleted along with each device UUID in PRE-REQUEST\n2. Using get it will repopulate the list of devices using UUID and store each UUID with matching name."
			},
			"response": []
		},
		{
			"name": "CSO-get_device_info",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"console.log('-------------------- DEVICE SPECS --------------------------------------');",
							"nextRequest = null;",
							"var jsonData = JSON.parse(responseBody);",
							"",
							"if (pm.response.code == 200 || jsonData.length > 0) {",
							"    if (Array.isArray(jsonData.device)) {",
							"        jsonData.device.forEach(function(item) {",
							"            pm.collectionVariables.set('device_serial_number',item.system_info.serial_number);",
							"            pm.collectionVariables.set('device_mac',item.mac_address);",
							"            nextRequest = 'MIST-asign_device';",
							"        })",
							"    }",
							"    else {",
							"        pm.collectionVariables.set('device_serial_number',jsonData.device.system_info.serial_number.toUpperCase());",
							"        pm.collectionVariables.set('device_mac',jsonData.device.mac_address.replace(/:/g,''));    ",
							"        nextRequest = 'MIST-asign_device';",
							"    }",
							"    pm.test(`Found device MAC: ${jsonData.device.mac_address} and serial number ${jsonData.device.system_info.serial_number.toUpperCase()}`, function() {",
							"      pm.expect(pm.response.code).to.equal(200);",
							"    });",
							"}",
							"",
							"console.log(`Device SN ${pm.collectionVariables.get('device_serial_number')} and MAC ${pm.collectionVariables.get('device_mac')}`);",
							"console.log(`setting next request ... ${nextRequest}`);",
							"postman.setNextRequest(nextRequest);"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "apikey",
					"apikey": [
						{
							"key": "value",
							"value": "{{token}}",
							"type": "string"
						},
						{
							"key": "key",
							"value": "x-auth-token",
							"type": "string"
						},
						{
							"key": "in",
							"value": "header",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [
					{
						"key": "x-auth-token",
						"type": "text",
						"value": "{{token}}",
						"disabled": true
					}
				],
				"url": {
					"raw": "{{base_url}}/ems-central/device/{{cso_site_uuid}}",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"ems-central",
						"device",
						"{{cso_site_uuid}}"
					]
				},
				"description": "# GET retrieving list of ALL devices\n\nThis GET will retrieve list of all devices in given tenant, depending on **Enviroment** used.Store each one *device name* and *UUID* as local variable and also add UUID to a list.\nReason is that to get status -** UP or DOWN** requires UUID with string -JUNOS. Unfortunately names do not work.\n \n1. Look if local collection variable exist and is not empty. If so, it will get deleted along with each device UUID in PRE-REQUEST\n2. Using get it will repopulate the list of devices using UUID and store each UUID with matching name."
			},
			"response": []
		},
		{
			"name": "MIST-asign_device",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"var mac = pm.collectionVariables.get('device_mac');",
							"var moment = require('moment');",
							"console.log('-------------------- MIST ASSIGN DEVICE --------------------------------------');",
							"nextRequest = null;",
							"",
							"",
							"if (pm.response.headers.get('Content-Type') == 'application/json') {",
							"    var jsonData = JSON.parse(responseBody);",
							"",
							"    //console.log('indexOf ... ',jsonData.json.success.indexOf(mac));",
							"    if (jsonData.success.indexOf(mac) != -1 && pm.response.code == 200 ) {",
							"        console.log(`Device ${mac} assigned successfuly in MIST to a Site ${pm.environment.get('site_name')}, sleeping 10 minutes to gather some stats.... `);   ",
							"        pm.test(`Device ${mac} assigned successfuly in MIST to a Site ${pm.environment.get('site_name')} .... `, function() {",
							"          pm.expect(jsonData.success.indexOf(mac)) != -1;",
							"        });",
							"        // Let's take a 15 minut nap for MIST to get some data",
							"        setTimeout(function() {}, 60000*15); // sleep TEN minute's and search for job ID",
							"        nextRequest = 'CSO-site_delete';",
							"      }",
							"}",
							"console.log(`setting next request ... ${nextRequest}`);",
							"postman.setNextRequest(nextRequest);"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"mac = pm.environment.get('device_mac');",
							"if ( mac == true || (mac && mac.length > 0)) {",
							"    pm.environment.unset('device_mac');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "apikey",
					"apikey": [
						{
							"key": "value",
							"value": "Token {{mist_apitoken}}",
							"type": "string"
						},
						{
							"key": "key",
							"value": "Authorization",
							"type": "string"
						},
						{
							"key": "in",
							"value": "header",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [
					{
						"key": "Accept",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "X-CSRFToken",
						"value": "{{csrftoken}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"op\": \"assign\",\n    \"site_id\": \"{{site_id}}\",\n    \"macs\": [\n        \"{{device_mac}}\"\n    ],\n    \"no_reassign\": false\n}\n",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "https://{{host}}/api/v1/orgs/:org_id/inventory",
					"protocol": "https",
					"host": [
						"{{host}}"
					],
					"path": [
						"api",
						"v1",
						"orgs",
						":org_id",
						"inventory"
					],
					"variable": [
						{
							"key": "org_id",
							"value": "{{org_id}}",
							"description": "ORganization from Enviroment values"
						}
					]
				},
				"description": "#### Body Parameters\n**Parameter**|**Type**|**Description** \n:-------------: |:-------------: |:-------------: \nop|string|Required. unassign\nmacs|list|list of MAC, e.g. 5c5b350e0001"
			},
			"response": [
				{
					"name": "MIST-asign_device",
					"originalRequest": {
						"method": "PUT",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "X-CSRFToken",
								"value": "{{csrftoken}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"op\": \"assign\",\n    \"site_id\": \"{{site_id}}\",\n    \"macs\": [\n        \"{{device_mac}}\"\n    ],\n    \"no_reassign\": false\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "https://{{host}}/api/v1/orgs/:org_id/inventory",
							"protocol": "https",
							"host": [
								"{{host}}"
							],
							"path": [
								"api",
								"v1",
								"orgs",
								":org_id",
								"inventory"
							],
							"variable": [
								{
									"key": "org_id",
									"value": "{{org_id}}",
									"description": "ORganization from Enviroment values"
								}
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Date",
							"value": "Thu, 24 Feb 2022 23:20:29 GMT"
						},
						{
							"key": "Content-Type",
							"value": "application/json"
						},
						{
							"key": "Content-Length",
							"value": "65"
						},
						{
							"key": "Connection",
							"value": "keep-alive"
						},
						{
							"key": "Vary",
							"value": "Accept, Cookie"
						},
						{
							"key": "Allow",
							"value": "GET, POST, OPTIONS, PUT"
						},
						{
							"key": "X-Frame-Options",
							"value": "DENY"
						},
						{
							"key": "Cache-Control",
							"value": "no-cache, no-store"
						},
						{
							"key": "Pragma",
							"value": "no-cache"
						},
						{
							"key": "vary",
							"value": "Origin"
						},
						{
							"key": "Access-Control-Allow-Credentials",
							"value": "true"
						},
						{
							"key": "Access-Control-Expose-Headers",
							"value": "X-Auth-Token,X-CSRFToken,X-Page-Limit,X-Page-Page,X-Page-Total,X-Requested-With"
						},
						{
							"key": "Content-Security-Policy",
							"value": "default-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';"
						},
						{
							"key": "X-Content-Type-Options",
							"value": "nosniff"
						},
						{
							"key": "X-Xss-Protection",
							"value": "1; mode=block"
						},
						{
							"key": "Strict-Transport-Security",
							"value": "max-age=31536000; includeSubDomains; preload"
						},
						{
							"key": "Referrer-Policy",
							"value": "strict-origin-when-cross-origin"
						},
						{
							"key": "Permissions-Policy",
							"value": "geolocation=()"
						},
						{
							"key": "X-Kong-Upstream-Latency",
							"value": "164"
						},
						{
							"key": "X-Kong-Proxy-Latency",
							"value": "0"
						},
						{
							"key": "Via",
							"value": "kong/2.1.4"
						}
					],
					"cookie": [],
					"body": "{\n    \"op\": \"assign\",\n    \"success\": [\n        \"4c9614229e00\"\n    ],\n    \"error\": [],\n    \"reason\": []\n}"
				}
			]
		},
		{
			"name": "CSO-site_delete",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"console.log('-------------------- DELETE DEVICE --------------------------------------');",
							"console.log(`Deleting sites ${pm.environment.get('site_name')}`);",
							"var jsonData = JSON.parse(responseBody);",
							"nextRequest = null;",
							"",
							"pm.test(\"Status code is 200\", function() {",
							"  pm.expect(pm.response.code).to.equal(200);",
							"});",
							"",
							"if (pm.response.code ==200) {",
							"    pm.test(`Site ${pm.environment.get('site_name')} is being removed from CSO ...`, function() {",
							"        pm.expect(jsonData.output.job_id).length >= 1;",
							"    });",
							"    pm.collectionVariables.set(\"job_id\", jsonData.output.job_id)",
							"    console.log(`job: ${pm.collectionVariables.get('job_id')}`);",
							"",
							"    pm.collectionVariables.set(\"status\", jsonData.output.status)",
							"    console.log(`status: ${pm.collectionVariables.get('status')}`);",
							"    nextRequest = 'MIST-getOrgInventory'",
							"    setTimeout(function() {}, 60000*7); // sleep 7 minute's and search for job ID",
							"}",
							"console.log(`setting next request ... ${nextRequest}`);",
							"postman.setNextRequest(nextRequest);",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "apikey",
					"apikey": [
						{
							"key": "value",
							"value": "{{token}}",
							"type": "string"
						},
						{
							"key": "key",
							"value": "x-auth-token",
							"type": "string"
						},
						{
							"key": "in",
							"value": "header",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [
					{
						"key": "x-auth-token",
						"type": "text",
						"value": "{{token}}",
						"disabled": true
					},
					{
						"key": "Content-Type",
						"type": "text",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"input\": {\r\n        \"tenant_name\": \"{{tenant_name}}\",\r\n        \"remove_tenant\": false,\r\n        \"job_name_prefix\": \"Site Delete of {{site_name}}\",\r\n        \"sites\": [\r\n            {\r\n                \"site_name\": \"{{site_name}}\"\r\n            }\r\n        ],\r\n        \"forced\": true,\r\n        \"configuration_option\": \"load_recovery_script\",\r\n        \"detached\": true\r\n    }\r\n}"
				},
				"url": {
					"raw": "{{base_url}}/tssm/remove-site",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"tssm",
						"remove-site"
					]
				}
			},
			"response": []
		},
		{
			"name": "MIST-getOrgInventory",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "test",
					"script": {
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"var mac = pm.collectionVariables.get('device_mac');",
							"var serial = pm.collectionVariables.get('device_serial_number');",
							"var existin_in_mist = false;",
							"console.log('----------------------------------------------------------');",
							"console.log('MAC:',mac,'Serial:',serial);",
							"nextRequest = null;",
							"",
							"if (pm.response.code == 200 && jsonData.length >= 1) {",
							"    if (Array.isArray(jsonData)) {",
							"        jsonData.forEach(function(item) {",
							"            if (item.mac == mac && item.serial == serial ) {",
							"                pm.environment.set('device_mac', mac);",
							"                existin_in_mist = true;",
							"                console.log('Found the MAC with matching Serial number in MIST.... ');",
							"                if (item.site_id == null) {",
							"                    nextRequest = 'MIST-delete_inventory'",
							"                    console.log('Device not assigned to any site ...');",
							"                }",
							"                else {",
							"                    nextRequest = \"MIST-unasign_device\"",
							"                }    ",
							"            }",
							"        })",
							"    }",
							"}    ",
							"if (existin_in_mist = false) {",
							"    console.log('Device not assigned to any site in MIST');",
							"    //nextRequest = 'CSO-get_token' // Next hop to create site again if needed instead of PM Runner loop control",
							"    //setTimeout(function() {}, 60000*2);",
							"}",
							"console.log(`setting next request ... ${nextRequest}`);",
							"postman.setNextRequest(nextRequest);"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "apikey",
					"apikey": [
						{
							"key": "value",
							"value": "Token {{mist_apitoken}}",
							"type": "string"
						},
						{
							"key": "key",
							"value": "Authorization",
							"type": "string"
						},
						{
							"key": "in",
							"value": "header",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "https://{{host}}/api/v1/orgs/:org_id/inventory",
					"protocol": "https",
					"host": [
						"{{host}}"
					],
					"path": [
						"api",
						"v1",
						"orgs",
						":org_id",
						"inventory"
					],
					"variable": [
						{
							"key": "org_id",
							"value": "{{org_id}}"
						}
					]
				},
				"description": "#### Response Parameters\n**Parameter**|**Type**|**Description** \nserial|string|device serial\nmodel|string|device model\ntype|string|device type, ap\nmac|string|MAC address\nname|string|device name if assigned\nid|string|device id\nsite_id|string|site id if assigned, null if not assigned\ndeviceprofile_id|string|deviceprofile id if assigned, null if not assigned\nconnected|boolean|whether the AP is connected\ncreated_time|long|inventory created time, in epoch\nmodified_time|long|inventory last modified time, in epoch\n\n\n#### Query Options\n* Filtered Inventory by\n * model\n * serial\n * magic\n * site_id\n * type\n * mac\n * vc_mac\n * vc\n\nExample:\n```\nhttps://{{host}}/api/v1/orgs/:org_id/inventory?model=AP41\n```\n\n### VC (Virtual-Chassis) Management\nIdeally VC should be managed as a single device - where - one managed entity where config / monitoring is anchored against (with a stable identify MAC) - all members appears in the inventory\n\nIn our implementation, we strive to achieve that without manual user configurations by \n1. during claim or adoption a VC, we require FPC0 to exist and will use its MAC as identify for the entire chassis \n2. other VC members will be automatically populated when theyre all present\n\nThe perceivable result is \n1. from /sites/:site_id/stats/devices/:fpc0_mac API, youd see the VC where module_stat contains the VC members \n2. from /orgs/:org_id/inventory?vc=true API, youd see all VC members with vc_mac pointing to the FPC0"
			},
			"response": [
				{
					"name": "MIST-getOrgInventory",
					"originalRequest": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "https://{{host}}/api/v1/orgs/:org_id/inventory",
							"protocol": "https",
							"host": [
								"{{host}}"
							],
							"path": [
								"api",
								"v1",
								"orgs",
								":org_id",
								"inventory"
							],
							"variable": [
								{
									"key": "org_id",
									"value": "{{org_id}}"
								}
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Date",
							"value": "Thu, 24 Feb 2022 21:47:57 GMT"
						},
						{
							"key": "Content-Type",
							"value": "application/json"
						},
						{
							"key": "Content-Length",
							"value": "5054"
						},
						{
							"key": "Connection",
							"value": "keep-alive"
						},
						{
							"key": "X-Page-Total",
							"value": "13"
						},
						{
							"key": "X-Page-Limit",
							"value": "100"
						},
						{
							"key": "X-Page-Page",
							"value": "1"
						},
						{
							"key": "Vary",
							"value": "Accept, Cookie"
						},
						{
							"key": "Allow",
							"value": "PUT, OPTIONS, POST, GET"
						},
						{
							"key": "X-Frame-Options",
							"value": "DENY"
						},
						{
							"key": "Cache-Control",
							"value": "no-cache, no-store"
						},
						{
							"key": "Pragma",
							"value": "no-cache"
						},
						{
							"key": "vary",
							"value": "Origin"
						},
						{
							"key": "Access-Control-Allow-Credentials",
							"value": "true"
						},
						{
							"key": "Access-Control-Expose-Headers",
							"value": "X-Auth-Token,X-CSRFToken,X-Page-Limit,X-Page-Page,X-Page-Total,X-Requested-With"
						},
						{
							"key": "Content-Security-Policy",
							"value": "default-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';"
						},
						{
							"key": "X-Content-Type-Options",
							"value": "nosniff"
						},
						{
							"key": "X-Xss-Protection",
							"value": "1; mode=block"
						},
						{
							"key": "Strict-Transport-Security",
							"value": "max-age=31536000; includeSubDomains; preload"
						},
						{
							"key": "Referrer-Policy",
							"value": "strict-origin-when-cross-origin"
						},
						{
							"key": "Permissions-Policy",
							"value": "geolocation=()"
						},
						{
							"key": "X-Kong-Upstream-Latency",
							"value": "30"
						},
						{
							"key": "X-Kong-Proxy-Latency",
							"value": "1"
						},
						{
							"key": "Via",
							"value": "kong/2.1.4"
						}
					],
					"cookie": [],
					"body": "[\n    {\n        \"mac\": \"c8fe6a5de2b7\",\n        \"serial\": \"HV3620330390\",\n        \"model\": \"EX2300-C-12P\",\n        \"sku\": \"EX2300-C-12P\",\n        \"hw_rev\": \"C\",\n        \"type\": \"switch\",\n        \"magic\": \"AQ9T56WZMA9D7HZ\",\n        \"name\": \"EX2300-C12P-POE\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"site_id\": \"c48d8f39-67da-4767-8c2b-25c73a693ee0\",\n        \"created_time\": 1617989455,\n        \"modified_time\": 1629983064,\n        \"id\": \"00000000-0000-0000-1000-c8fe6a5de2b7\",\n        \"deviceprofile_id\": null,\n        \"connected\": false\n    },\n    {\n        \"mac\": \"e8a24550b932\",\n        \"serial\": \"CW2720AF0341\",\n        \"model\": \"SRX320\",\n        \"sku\": \"\",\n        \"hw_rev\": \"\",\n        \"type\": \"gateway\",\n        \"magic\": \"\",\n        \"name\": \"OpenLab.site3LTE\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"site_id\": \"05e22595-2b20-41f7-9620-daaca1ed084a\",\n        \"created_time\": 1629988175,\n        \"modified_time\": 1630429539,\n        \"id\": \"00000000-0000-0000-1000-e8a24550b932\",\n        \"adopted\": true,\n        \"deviceprofile_id\": null,\n        \"connected\": false\n    },\n    {\n        \"mac\": \"4c9614159e00\",\n        \"serial\": \"27F7749E9225\",\n        \"model\": \"VSRX\",\n        \"sku\": \"\",\n        \"hw_rev\": \"\",\n        \"type\": \"gateway\",\n        \"magic\": \"\",\n        \"name\": \"PB-site-15\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"site_id\": \"ac2ada26-7ca9-454e-aaaf-a0b331ca4bb4\",\n        \"created_time\": 1636655201,\n        \"modified_time\": 1636667636,\n        \"id\": \"00000000-0000-0000-1000-4c9614159e00\",\n        \"adopted\": true,\n        \"deviceprofile_id\": null,\n        \"connected\": false\n    },\n    {\n        \"mac\": \"4c961432e900\",\n        \"serial\": \"03AC373491F6\",\n        \"model\": \"VSRX\",\n        \"sku\": \"\",\n        \"hw_rev\": \"\",\n        \"type\": \"gateway\",\n        \"magic\": \"\",\n        \"name\": \"PBSC-Site-2\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"site_id\": \"5fd93ae2-75c3-4911-968e-fd0e0cb5dd23\",\n        \"created_time\": 1636655197,\n        \"modified_time\": 1636667623,\n        \"id\": \"00000000-0000-0000-1000-4c961432e900\",\n        \"adopted\": true,\n        \"deviceprofile_id\": null,\n        \"connected\": false\n    },\n    {\n        \"mac\": \"4c961433e900\",\n        \"serial\": \"A9C28B6F93C6\",\n        \"model\": \"VSRX\",\n        \"sku\": \"\",\n        \"hw_rev\": \"\",\n        \"type\": \"gateway\",\n        \"magic\": \"\",\n        \"name\": \"PBSC-Site-3\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"site_id\": \"5fd93ae2-75c3-4911-968e-fd0e0cb5dd23\",\n        \"created_time\": 1636655197,\n        \"modified_time\": 1636667624,\n        \"id\": \"00000000-0000-0000-1000-4c961433e900\",\n        \"adopted\": true,\n        \"deviceprofile_id\": null,\n        \"connected\": false\n    },\n    {\n        \"mac\": \"4c961434e900\",\n        \"serial\": \"8729DD10E901\",\n        \"model\": \"VSRX\",\n        \"sku\": \"\",\n        \"hw_rev\": \"\",\n        \"type\": \"gateway\",\n        \"magic\": \"\",\n        \"name\": \"PBSC-Site-4\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"site_id\": \"5fd93ae2-75c3-4911-968e-fd0e0cb5dd23\",\n        \"created_time\": 1636655201,\n        \"modified_time\": 1636667625,\n        \"id\": \"00000000-0000-0000-1000-4c961434e900\",\n        \"adopted\": true,\n        \"deviceprofile_id\": null,\n        \"connected\": false\n    },\n    {\n        \"mac\": \"4c961435e900\",\n        \"serial\": \"746F2376B210\",\n        \"model\": \"VSRX\",\n        \"sku\": \"\",\n        \"hw_rev\": \"\",\n        \"type\": \"gateway\",\n        \"magic\": \"\",\n        \"name\": \"PBSC-Site-5\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"site_id\": \"5fd93ae2-75c3-4911-968e-fd0e0cb5dd23\",\n        \"created_time\": 1636655201,\n        \"modified_time\": 1636667625,\n        \"id\": \"00000000-0000-0000-1000-4c961435e900\",\n        \"adopted\": true,\n        \"deviceprofile_id\": null,\n        \"connected\": false\n    },\n    {\n        \"mac\": \"4c9614169e00\",\n        \"serial\": \"B9D9AA369BF3\",\n        \"model\": \"VSRX\",\n        \"sku\": \"\",\n        \"hw_rev\": \"\",\n        \"type\": \"gateway\",\n        \"magic\": \"\",\n        \"name\": \"OpenLab.PB-Site16\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"site_id\": \"ba9da8b8-8f12-4fbc-8c50-ea03b89efbc8\",\n        \"created_time\": 1633376588,\n        \"modified_time\": 1633376643,\n        \"id\": \"00000000-0000-0000-1000-4c9614169e00\",\n        \"adopted\": true,\n        \"deviceprofile_id\": null,\n        \"connected\": false\n    },\n    {\n        \"mac\": \"4c9614119e00\",\n        \"serial\": \"AFC068C4F722\",\n        \"model\": \"VSRX\",\n        \"sku\": \"\",\n        \"hw_rev\": \"\",\n        \"type\": \"gateway\",\n        \"magic\": \"\",\n        \"name\": \"OpenLab.PB-Site-11\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"site_id\": \"c48d8f39-67da-4767-8c2b-25c73a693ee0\",\n        \"created_time\": 1633376827,\n        \"modified_time\": 1633376853,\n        \"id\": \"00000000-0000-0000-1000-4c9614119e00\",\n        \"adopted\": true,\n        \"deviceprofile_id\": null,\n        \"connected\": true\n    },\n    {\n        \"mac\": \"d420b0426737\",\n        \"serial\": \"A074220070605\",\n        \"model\": \"AP43\",\n        \"sku\": \"AP43-US\",\n        \"hw_rev\": \"D05\",\n        \"type\": \"ap\",\n        \"magic\": \"BPZM3NP3T26ZGL6\",\n        \"name\": \"PB-site-11-AP1\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"site_id\": \"c48d8f39-67da-4767-8c2b-25c73a693ee0\",\n        \"created_time\": 1607814157,\n        \"modified_time\": 1629997011,\n        \"id\": \"00000000-0000-0000-1000-d420b0426737\",\n        \"deviceprofile_id\": null,\n        \"connected\": true\n    },\n    {\n        \"mac\": \"0c599c60960e\",\n        \"serial\": \"HW3620170533\",\n        \"model\": \"EX2300-C-12T\",\n        \"sku\": \"EX2300-C-12T\",\n        \"hw_rev\": \"B\",\n        \"type\": \"switch\",\n        \"magic\": \"CPDJGFVFJPNZ247\",\n        \"name\": \"EX2300-C-12T-NON-POE\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"site_id\": \"c48d8f39-67da-4767-8c2b-25c73a693ee0\",\n        \"created_time\": 1608317137,\n        \"modified_time\": 1630054395,\n        \"id\": \"00000000-0000-0000-1000-0c599c60960e\",\n        \"deviceprofile_id\": null,\n        \"connected\": true\n    },\n    {\n        \"mac\": \"84c1c1a8c4c0\",\n        \"serial\": \"CZ2616AF0520\",\n        \"model\": \"SRX345\",\n        \"sku\": \"\",\n        \"hw_rev\": \"\",\n        \"type\": \"gateway\",\n        \"magic\": \"\",\n        \"name\": \"OpenLab.PB-Site-9\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"site_id\": \"8f98bc63-5390-4282-8c2e-69ec306258c6\",\n        \"created_time\": 1634301792,\n        \"modified_time\": 1634301835,\n        \"id\": \"00000000-0000-0000-1000-84c1c1a8c4c0\",\n        \"adopted\": true,\n        \"deviceprofile_id\": null,\n        \"connected\": false\n    },\n    {\n        \"mac\": \"4c9614229e00\",\n        \"serial\": \"8BE67CCC6CF9\",\n        \"model\": \"VSRX\",\n        \"sku\": \"\",\n        \"hw_rev\": \"\",\n        \"type\": \"gateway\",\n        \"magic\": \"\",\n        \"name\": \"\",\n        \"org_id\": \"3ff8389b-9c76-4938-89d7-884956f0ad23\",\n        \"site_id\": \"6d7579cb-7686-4fbb-a32e-6ec7a96439dd\",\n        \"created_time\": 1644209831,\n        \"modified_time\": 1644879400,\n        \"id\": \"00000000-0000-0000-1000-4c9614229e00\",\n        \"adopted\": true,\n        \"deviceprofile_id\": null,\n        \"connected\": true\n    }\n]"
				}
			]
		},
		{
			"name": "MIST-unasign_device",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"var mac = pm.collectionVariables.get('device_mac');",
							"console.log('----------------------------------------------------------');",
							"nextRequest = null;",
							"",
							"pm.test(\"Status code is 200\", function() {",
							"  pm.expect(pm.response.code).to.equal(200);",
							"});",
							"",
							"if (pm.response.headers.get('Content-Type') == 'application/json') {",
							"    var jsonData = JSON.parse(responseBody);",
							"    pm.test(\"Results is not empty\", function() {",
							"    pm.expect(jsonData).length >= 1;",
							"    });",
							"    //console.log('indexOf ... ',jsonData.json.success.indexOf(mac));",
							"    if (jsonData.success.indexOf(mac) != -1 && pm.response.code == 200 ) {",
							"        console.log(`Device ${mac} unassigned successfuly in MIST from Site.... `);",
							"        nextRequest = \"MIST-delete_inventory\"",
							"    ",
							"    }",
							"}",
							"console.log(`setting next request ... ${nextRequest}`);",
							"postman.setNextRequest(nextRequest);"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "apikey",
					"apikey": [
						{
							"key": "value",
							"value": "Token {{mist_apitoken}}",
							"type": "string"
						},
						{
							"key": "key",
							"value": "Authorization",
							"type": "string"
						},
						{
							"key": "in",
							"value": "header",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [
					{
						"key": "Accept",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "X-CSRFToken",
						"value": "{{csrftoken}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"op\": \"unassign\",\n    \"macs\": [\n        \"{{device_mac}}\"\n    ]\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "https://{{host}}/api/v1/orgs/:org_id/inventory",
					"protocol": "https",
					"host": [
						"{{host}}"
					],
					"path": [
						"api",
						"v1",
						"orgs",
						":org_id",
						"inventory"
					],
					"variable": [
						{
							"key": "org_id",
							"value": "{{org_id}}",
							"description": "ORganization from Enviroment values"
						}
					]
				},
				"description": "#### Body Parameters\n**Parameter**|**Type**|**Description** \n:-------------: |:-------------: |:-------------: \nop|string|Required. unassign\nmacs|list|list of MAC, e.g. 5c5b350e0001"
			},
			"response": []
		},
		{
			"name": "MIST-delete_inventory",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"console.log('----------------------------------------------------------');",
							"var mac = pm.collectionVariables.get('device_mac');",
							"//var serial = pm.collectionVariables.get('device_serial_number');",
							"",
							"",
							"if (pm.response.code == 200 && pm.response.headers.get('Content-Type') == 'application/json') {",
							"    var jsonData = JSON.parse(responseBody);",
							"    //console.log('indexOf ... ',jsonData.success.indexOf(mac));",
							"    if (jsonData.success.indexOf(mac) != -1 ) {",
							"        pm.test(`Device ${mac} released successfuly from MIST org .... `, function() {",
							"            pm.expect(jsonData.success.indexOf(mac)) != 1;",
							"        });",
							"        console.log(`Device ${mac} released successfuly from MIST org .... `);",
							"        //extRequest = 'CSO-get_token';",
							"        setTimeout(function() {}, 60000 * 2); // sleep 2 minute's and search for Service provision job ID",
							"    }",
							"//    if (jsonData.error.indexOf(mac) != -1 || jsonData.error.indexOf(serial) != -1 ) {",
							"    if (jsonData.error.indexOf(mac) != -1 ) {",
							"        console.log(`Device ${mac} - ${jsonData.reason} in MIST org .... `);",
							"    }",
							"}",
							"console.log('----------------------------------------------------------');",
							"console.log('----------------------------------------------------------');",
							"console.log('----------------------------------------------------------');"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "apikey",
					"apikey": [
						{
							"key": "value",
							"value": "Token {{mist_apitoken}}",
							"type": "string"
						},
						{
							"key": "key",
							"value": "Authorization",
							"type": "string"
						},
						{
							"key": "in",
							"value": "header",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [
					{
						"key": "Accept",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "X-CSRFToken",
						"value": "{{csrftoken}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"op\": \"delete\",\n    \"macs\": [\n        \"{{device_mac}}\"\n    ]\n}\n\n",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "https://{{host}}/api/v1/orgs/:org_id/inventory",
					"protocol": "https",
					"host": [
						"{{host}}"
					],
					"path": [
						"api",
						"v1",
						"orgs",
						":org_id",
						"inventory"
					],
					"variable": [
						{
							"key": "org_id",
							"value": "{{org_id}}"
						}
					]
				},
				"description": "#### Body Parameters\n**Parameter**|**Type**|**Description** \n:-------------: |:-------------: |:-------------: \nop|string|Required. delete\nserials|list|list of serial numbers, e.g. FXLH2015150025\nmacs|list|list of MAC, e.g. 5c5b350e0001"
			},
			"response": [
				{
					"name": "MIST-delete_inventory",
					"originalRequest": {
						"method": "PUT",
						"header": [
							{
								"key": "Accept",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "X-CSRFToken",
								"value": "{{csrftoken}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"op\": \"delete\",\n    \"serials\": [\n        \"{{device_serial_number}}\"\n    ],\n    \"macs\": [\n        \"{{device_mac}}\"\n    ]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "https://{{host}}/api/v1/orgs/:org_id/inventory",
							"protocol": "https",
							"host": [
								"{{host}}"
							],
							"path": [
								"api",
								"v1",
								"orgs",
								":org_id",
								"inventory"
							],
							"variable": [
								{
									"key": "org_id",
									"value": "{{org_id}}"
								}
							]
						}
					},
					"_postman_previewlanguage": "json",
					"header": null,
					"cookie": [],
					"body": "{\n    \"op\": \"delete\",\n    \"success\": [\n        \"8BE67CCC6CF9\"\n    ],\n    \"error\": [\n        \"4c9614229e00\"\n    ],\n    \"reason\": [\n        \"does not exist\"\n    ]\n}"
				}
			]
		}
	],
	"auth": {
		"type": "apikey",
		"apikey": [
			{
				"key": "value",
				"value": "{{token}}",
				"type": "string"
			},
			{
				"key": "key",
				"value": "x-auth-token",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	]
}